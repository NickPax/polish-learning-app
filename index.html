<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teraz Polski - Learn Polish Language</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
:root {
--primary: #4361ee;
--secondary: #3f37c9;
--success: #4cc9f0;
--light-bg: #f8f9fa;
--dark-bg: #121826;
--card-light: #ffffff;
--card-dark: #1e293b;
--text-light: #212529;
--text-dark: #f1f5f9;
--shadow-light: rgba(0, 0, 0, 0.1);
--shadow-dark: rgba(0, 0, 0, 0.3);
--border-light: #dee2e6;
--border-dark: #334155;
--option-bg-light: white;
--option-bg-dark: #334155;
--correct: #4ade80;
--incorrect: #f87171;
--feedback-correct-light: #d1fae5;
--feedback-correct-dark: #064e3b;
--feedback-incorrect-light: #fee2e2;
--feedback-incorrect-dark: #7f1d1d;
--score-badge-bg: #fbbf24;
--score-badge-text: #1e293b;
}
body {
background: var(--bg);
color: var(--text);
min-height: 100vh;
padding: 20px;
transition: background-color 0.3s, color 0.3s;
}
.container {
max-width: 900px;
margin: 0 auto;
}
header {
text-align: center;
padding: 20px 0;
margin-bottom: 30px;
display: flex;
justify-content: space-between;
align-items: center;
}
.logo-container {
text-align: center;
flex: 1;
}
h1 {
font-size: 2.5rem;
color: var(--primary);
margin-bottom: 10px;
text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
.subtitle {
color: var(--secondary);
font-size: 1.1rem;
max-width: 600px;
margin: 0 auto;
}
.theme-toggle {
background: var(--card);
border: 1px solid var(--border);
width: 50px;
height: 50px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
box-shadow: 0 2px 6px var(--shadow);
transition: all 0.3s;
}
.theme-toggle:hover {
transform: rotate(20deg);
}
.progress-container {
background: var(--card);
border-radius: 12px;
padding: 20px;
box-shadow: 0 4px 12px var(--shadow);
margin-bottom: 30px;
border: 1px solid var(--border);
}
.progress-header {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
font-weight: 600;
color: var(--secondary);
}
.progress-bar {
height: 12px;
background: var(--option-bg);
border-radius: 6px;
overflow: hidden;
border: 1px solid var(--border);
}
.progress-fill {
height: 100%;
background: linear-gradient(90deg, var(--primary), var(--success));
border-radius: 6px;
width: 0%;
transition: width 0.5s ease;
}
.points-display {
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
margin-top: 15px;
font-size: 1.2rem;
font-weight: 700;
color: var(--warning);
}
.exercise-container {
background: var(--card);
border-radius: 12px;
padding: 30px;
box-shadow: 0 4px 12px var(--shadow);
margin-bottom: 30px;
min-height: 300px;
display: flex;
flex-direction: column;
border: 1px solid var(--border);
}
.exercise-title {
font-size: 1.5rem;
margin-bottom: 20px;
color: var(--secondary);
display: flex;
align-items: center;
gap: 10px;
justify-content: space-between;
}
.topic-name {
font-weight: 600;
color: var(--primary);
}
.back-btn {
background: none;
border: none;
color: var(--secondary);
font-weight: 600;
cursor: pointer;
display: flex;
align-items: center;
gap: 5px;
}
.back-btn:hover {
color: var(--primary);
}
.exercise-content {
flex: 1;
display: flex;
flex-direction: column;
justify-content: center;
}
.missing-word-exercise {
text-align: center;
}
.sentence {
font-size: 1.4rem;
line-height: 1.6;
margin-bottom: 25px;
padding: 15px;
background: var(--bg-sentence);
border-radius: 8px;
border-left: 4px solid var(--primary);
}
.options-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 12px;
margin-top: 20px;
}
.option-btn {
padding: 12px 15px;
border: 2px solid var(--border);
border-radius: 8px;
background: var(--option-bg);
font-size: 1.1rem;
cursor: pointer;
transition: all 0.2s;
font-weight: 600;
color: var(--text);
}
.option-btn:hover:not(:disabled) {
border-color: var(--primary);
transform: translateY(-2px);
box-shadow: 0 4px 8px var(--shadow);
}
.option-btn:disabled {
opacity: 0.8;
cursor: not-allowed;
}
.option-btn.selected {
background: var(--primary);
color: white;
border-color: var(--primary);
}
.option-btn.correct {
background: var(--correct);
border-color: var(--correct);
color: white;
}
.option-btn.incorrect {
background: var(--incorrect);
border-color: var(--incorrect);
color: white;
}
.tts-exercise {
text-align: center;
}
.audio-controls {
display: flex;
justify-content: center;
gap: 15px;
margin: 25px 0;
}
.play-btn {
width: 60px;
height: 60px;
border-radius: 50%;
background: var(--primary);
color: white;
border: none;
font-size: 1.5rem;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 12px var(--shadow);
transition: all 0.2s;
}
.play-btn:hover {
background: var(--secondary);
transform: scale(1.05);
}
.play-btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none;
}
.topics-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-top: 20px;
}
.topic-card {
padding: 20px;
border: 2px solid var(--border);
border-radius: 10px;
background: var(--option-bg);
cursor: pointer;
transition: all 0.2s;
text-align: center;
font-weight: 600;
color: var(--text);
}
.topic-card:hover:not(.selected):not(.locked) {
border-color: var(--primary);
transform: translateY(-3px);
box-shadow: 0 4px 8px var(--shadow);
}
.topic-card.selected {
background: var(--primary);
color: white;
border-color: var(--primary);
}
.topic-card.locked {
opacity: 0.8;
cursor: not-allowed;
}
.feedback {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
text-align: center;
font-weight: 600;
display: none;
}
.feedback.correct {
background: var(--feedback-correct);
color: var(--feedback-correct-text);
display: block;
}
.feedback.incorrect {
background: var(--feedback-incorrect);
color: var(--feedback-incorrect-text);
display: block;
}
.navigation {
display: flex;
justify-content: space-between;
margin-top: 20px;
}
.btn {
padding: 12px 25px;
border: none;
border-radius: 8px;
font-size: 1.1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}
.btn-prev {
background: var(--border);
color: var(--text);
}
.btn-prev:hover {
background: var(--primary);
color: white;
}
.btn-next {
background: var(--primary);
color: white;
}
.btn-next:hover {
background: var(--secondary);
}
.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
}
.completion-screen, .topic-selection-screen {
text-align: center;
padding: 40px 20px;
}
.completion-screen h2, .topic-selection-screen h2 {
font-size: 2.2rem;
margin-bottom: 20px;
}
.final-score {
font-size: 1.8rem;
font-weight: 700;
color: var(--warning);
margin: 20px 0;
}
.action-buttons {
margin-top: 25px;
display: flex;
justify-content: center;
gap: 15px;
flex-wrap: wrap;
}
.restart-btn, .continue-btn, .new-topic-btn, .full-restart-btn {
background: var(--success);
color: white;
padding: 12px 25px;
border: none;
border-radius: 8px;
font-size: 1.1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}
.restart-btn:hover, .continue-btn:hover, .new-topic-btn:hover, .full-restart-btn:hover {
background: #3ab7e4;
transform: scale(1.03);
}
.topic-options {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
gap: 20px;
margin-top: 30px;
}
.topic-option {
padding: 25px 15px;
background: var(--card);
border: 2px solid var(--border);
border-radius: 12px;
cursor: pointer;
transition: all 0.3s;
font-weight: 600;
color: var(--text);
position: relative;
}
.topic-option:hover {
border-color: var(--primary);
transform: translateY(-5px);
box-shadow: 0 6px 12px var(--shadow);
}
.topic-option i {
display: block;
font-size: 2rem;
margin-bottom: 10px;
color: var(--primary);
}
.score-badge {
position: absolute;
top: 10px;
right: 10px;
background: var(--score-badge-bg);
color: var(--score-badge-text);
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.8rem;
font-weight: bold;
box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.hidden {
display: none;
}
@media (max-width: 600px) {
.exercise-container {
padding: 20px;
}
h1 {
font-size: 2rem;
}
.sentence {
font-size: 1.2rem;
}
.options-container, .topics-container, .topic-options {
grid-template-columns: 1fr;
}
header {
flex-direction: column;
gap: 15px;
}
.score-badge {
width: 24px;
height: 24px;
font-size: 0.7rem;
}
.action-buttons {
gap: 10px;
}
.restart-btn, .new-topic-btn {
padding: 10px 20px;
font-size: 1rem;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<div class="logo-container">
<h1><i class="fas fa-language"></i> Teraz Polski</h1>
<p class="subtitle">Learn Polish through interactive exercises. Perfect for beginners and intermediate learners!</p>
</div>
<div class="theme-toggle" id="theme-toggle">
<i class="fas fa-moon"></i>
</div>
</header>
<div class="progress-container hidden" id="progress-container">
<div class="progress-header">
<span>Progress</span>
<span id="progress-text">0/5</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progress-fill"></div>
</div>
<div class="points-display">
<i class="fas fa-star"></i>
<span id="points">0</span> Points
</div>
</div>
<div class="exercise-container hidden" id="exercise-container">
<!-- Exercises will be loaded here -->
</div>
<div class="completion-screen hidden" id="completion-screen">
<h2 id="completion-message">Great Job! </h2>
<p>You've completed the topic!</p>
<div class="final-score">Your Score: <span id="final-score">0</span>/50 points</div>
<div class="action-buttons">
<button class="new-topic-btn" id="new-topic-btn">Choose Another Topic</button>
<button class="restart-btn" id="restart-topic-btn">Retry This Topic</button>
</div>
</div>
<div class="topic-selection-screen" id="topic-selection-screen">
<h2>Choose a Topic to Learn</h2>
<p>Select any topic to start learning Polish!</p>
<div class="topic-options" id="topic-options-container">
<!-- Topics will be populated here -->
</div>
</div>
</div>
<script>
// All 10 topics with 3 sets of 5 exercises each - POLISH CONTENT with ENGLISH INSTRUCTIONS
const allTopics = {
food: {name:"Food & Dining",icon:"fa-utensils",sets:[[{type:"missing-word",sentence:"Poprosz butelk ___.",options:["wody","domu","samochodu","krzesa"],correct:0,explanation:"'Wody' means water - a common drink order in Polish."},{type:"tts",audioText:"Zupa jest wymienita! Czy mo偶emy poprosi o rachunek?",topics:["Complaining","Praising food","Asking for directions","Ordering clothes"],correct:1,explanation:"The speaker is praising the soup and asking for the bill in Polish."},{type:"missing-word",sentence:"Ile kosztuje ___?",options:["menu","ksi偶yc","mysz","czapka"],correct:0,explanation:"'Menu' means menu in Polish restaurant context."},{type:"tts",audioText:"Jestem wegetarianinem. Czy macie dania wegetariaskie?",topics:["Dietary needs","Allergies","Cooking at home","Fast food"],correct:0,explanation:"The speaker is asking about vegetarian options in Polish."},{type:"missing-word",sentence:"Chciabym zam贸wi ___.",options:["piwo","ksi偶k","贸偶ko","od藕"],correct:0,explanation:"'Piwo' means beer - a common order in Poland."}],[{type:"missing-word",sentence:"Czy mog prosi o ___?",options:["kart da","no偶yczki","w偶a","misk"],correct:0,explanation:"'Kart da' means menu card in Polish."},{type:"tts",audioText:"Poprosz stek woowy rednio wysma偶ony.",topics:["Ordering meat","Asking for drinks","Requesting dessert","Complaining about service"],correct:0,explanation:"The speaker is ordering a medium-rare steak in Polish."},{type:"missing-word",sentence:"Jedzenie byo bardzo ___.",options:["smaczne","wolne","gone","puste"],correct:0,explanation:"'Smaczne' means delicious in Polish."},{type:"tts",audioText:"Czy macie dzisiaj menu lunchowe?",topics:["Asking about lunch specials","Checking opening hours","Requesting takeout","Asking for reservations"],correct:0,explanation:"The speaker is asking about lunch specials in Polish."},{type:"missing-word",sentence:"Jestem ___ i nie jem misa.",options:["wegetarianinem","szalonym","zagubionym","zirytowanym"],correct:0,explanation:"'Wegetarianinem' means vegetarian in Polish."}],[{type:"missing-word",sentence:"Jeszcze jedn ___ kawy, prosz.",options:["fili偶ank","st贸","ciereczk","garnek"],correct:0,explanation:"'Fili偶ank' means cup (of coffee) in Polish."},{type:"tts",audioText:"Przystawka bya fantastyczna! Wezm to samo danie g贸wne co wczoraj.",topics:["Praising food","Complaining","Asking for recommendations","Requesting the bill"],correct:0,explanation:"The speaker is praising the appetizer and ordering the same main course in Polish."},{type:"missing-word",sentence:"Rachunek, ___!",options:["prosz","lepiej","tanio","kolorowo"],correct:0,explanation:"'Prosz' means please in this context (asking for the bill)."},{type:"tts",audioText:"Przepraszam, ale w mojej zupie pywa mucha!",topics:["Complaining about food","Ordering dessert","Asking for water","Requesting a table"],correct:0,explanation:"The speaker is complaining about finding a fly in their soup in Polish."},{type:"missing-word",sentence:"Chciabym zam贸wi kawaek ___.",options:["ciasta","torebki","drzwi","schod贸w"],correct:0,explanation:"'Ciasta' means cake or pie in Polish."}]]},
travel: {name:"Travel & Directions",icon:"fa-plane",sets:[[{type:"missing-word",sentence:"Gdzie jest najbli偶szy ___?",options:["dworzec","banan","nied藕wied藕","ksi偶ka"],correct:0,explanation:"'Dworzec' means train station in Polish."},{type:"tts",audioText:"Przepraszam, jak dotrze do muzeum? Czy jest daleko std?",topics:["Asking for directions","Buying tickets","Checking into a hotel","Renting a car"],correct:0,explanation:"The speaker is asking how to get to the museum in Polish."},{type:"missing-word",sentence:"Potrzebuj ___ na trzy noce.",options:["pokoju","cukru","gazety","pocigu"],correct:0,explanation:"'Pokoju' means room (in a hotel) in Polish."},{type:"tts",audioText:"Pocig do Krakowa odje偶d偶a z toru 5. Uwaga, prosz si pospieszy!",topics:["Train announcements","Flight information","Bus schedules","Taxi services"],correct:0,explanation:"This is a train announcement about departure from platform 5 in Polish."},{type:"missing-word",sentence:"Ile kosztuje bilet do ___?",options:["Warszawy","psa","domu","rki"],correct:0,explanation:"'Warszawy' is Warsaw, the capital of Poland."}],[{type:"missing-word",sentence:"Czy mo偶esz mi pokaza na ___?",options:["mapie","cign","liczy","paci"],correct:0,explanation:"'Mapie' means map in Polish."},{type:"tts",audioText:"Chciabym zarezerwowa prosty pok贸j z prysznicem i niadaniem.",topics:["Booking a hotel room","Renting a car","Buying souvenirs","Asking for tourist info"],correct:0,explanation:"The speaker is booking a simple room with shower and breakfast in Polish."},{type:"missing-word",sentence:"Samolot ___ punktualnie.",options:["startuje","stoi","wznosi si","steruje"],correct:0,explanation:"'Startuje' means departs (for flights) in Polish."},{type:"tts",audioText:"Czy jest tu w pobli偶u punkt informacji turystycznej?",topics:["Asking for tourist info","Looking for restaurants","Finding public transport","Locating pharmacies"],correct:0,explanation:"The speaker is asking for a tourist information office in Polish."},{type:"missing-word",sentence:"Zgubiem sw贸j ___.",options:["paszport","parasol","plecak","piercionek"],correct:0,explanation:"'Paszport' means passport in Polish."}],[{type:"missing-word",sentence:"Jed藕 prosto do nastpnej ___.",options:["sygn邪lizacji","nowej","miej","mokrej"],correct:0,explanation:"'Sygn邪lizacji' means traffic lights in Polish."},{type:"tts",audioText:"Przepraszam, gdzie mog przechowa baga偶?",topics:["Asking about luggage storage","Finding restrooms","Locating currency exchange","Requesting wheelchair assistance"],correct:0,explanation:"The speaker is asking where to store their luggage in Polish."},{type:"missing-word",sentence:"Chc kupi ___ do Starego Miasta.",options:["bilet","st贸","ciereczk","garnek"],correct:0,explanation:"'Bilet' means ticket for public transport in Polish."},{type:"tts",audioText:"Autobus odje偶d偶a co 15 minut z dworca g贸wnego.",topics:["Bus schedules","Train delays","Flight cancellations","Taxi availability"],correct:0,explanation:"The sentence describes bus frequency from the main station in Polish."},{type:"missing-word",sentence:"Jak dotrze do najbli偶szego ___?",options:["lotniska","nowego","miego","mokrego"],correct:0,explanation:"'Lotniska' means airport in Polish."}]]},
family: {name:"Family & Friends",icon:"fa-users",sets:[[{type:"missing-word",sentence:"To jest moja ___.",options:["siostra","szkoa","but","w偶"],correct:0,explanation:"'Siostra' means sister in Polish."},{type:"tts",audioText:"M贸j ojciec pracuje jako lekarz, a moja matka jest nauczycielk.",topics:["Professions","Hobbies","Daily routine","Family members"],correct:3,explanation:"The speaker is talking about their parents (family members) in Polish."},{type:"missing-word",sentence:"Masz ___?",options:["rodzestwo","prezenty","gitar","ogr贸d"],correct:0,explanation:"'Rodzestwo' means siblings in Polish."},{type:"tts",audioText:"Moi dziadkowie mieszkaj w maej wsi na Mazurach.",topics:["Family members","Travel plans","Housing","Weather"],correct:0,explanation:"The speaker is talking about their grandparents (family members) in Polish."},{type:"missing-word",sentence:"Jutro obchodzimy urodziny ___.",options:["babci","owoc贸w","piekarnika","ucha"],correct:0,explanation:"'Babci' means grandmother's in Polish."}],[{type:"missing-word",sentence:"M贸j ___ ma na imi ukasz.",options:["brat","list","chleb","ksi偶ka"],correct:0,explanation:"'Brat' means brother in Polish."},{type:"tts",audioText:"Moja kuzynka przyje偶d偶a w przyszym miesicu z Niemiec.",topics:["Family visits","Travel plans","Work meetings","School events"],correct:0,explanation:"The speaker is talking about their cousin visiting in Polish."},{type:"missing-word",sentence:"Moi rodzice mieszkaj w ___ domu.",options:["starym","nowym","du偶ym","maym"],correct:1,explanation:"'Nowym' means new - describing their parents' house."},{type:"tts",audioText:"Mam dwie c贸rki i jednego syna.",topics:["Family composition","Work colleagues","Pet ownership","Friend groups"],correct:0,explanation:"The speaker is describing their children in Polish."},{type:"missing-word",sentence:"M贸j ___ jest 偶onaty.",options:["wujek","piekarnik","ucho","miejsce"],correct:0,explanation:"'Wujek' means uncle in Polish."}],[{type:"missing-word",sentence:"Moja ___ pracuje w banku.",options:["ciocia","torebka","brama","klatka"],correct:0,explanation:"'Ciocia' means aunt in Polish."},{type:"tts",audioText:"Spotykamy si w ka偶d niedziel na rodzinnej kolacji.",topics:["Family traditions","Work schedules","Hobby clubs","School activities"],correct:0,explanation:"The speaker describes a weekly family dinner tradition in Polish."},{type:"missing-word",sentence:"M贸j ___ ma pi lat.",options:["siostrzeniec","noc","imi","p贸noc"],correct:0,explanation:"'Siostrzeniec' means nephew in Polish."},{type:"tts",audioText:"Moi teciowie przyje偶d偶aj jutro w odwiedziny.",topics:["In-law visits","Friend gatherings","Business meetings","Doctor appointments"],correct:0,explanation:"The speaker mentions their in-laws visiting in Polish."},{type:"missing-word",sentence:"Nie mam ju偶 ___.",options:["dziadk贸w","prezent贸w","gitary","ogrodu"],correct:0,explanation:"'Dziadk贸w' means grandparents in Polish."}]]},
shopping: {name:"Shopping",icon:"fa-shopping-bag",sets:[[{type:"missing-word",sentence:"Ile kosztuje ta ___?",options:["kurtka","rok","chopiec","jogurt"],correct:0,explanation:"'Kurtka' means jacket (clothing item) in Polish."},{type:"tts",audioText:"Czy macie te buty te偶 w rozmiarze 42?",topics:["Asking for size","Returning items","Asking for price","Opening hours"],correct:0,explanation:"The speaker is asking if shoes are available in size 42 in Polish."},{type:"missing-word",sentence:"Chciabym te spodnie ___.",options:["wymieni","uczy","rozwa偶a","wiczy"],correct:0,explanation:"'Wymieni' means to exchange/return an item in Polish."},{type:"tts",audioText:"Kasa znajduje si po lewej stronie sklepu.",topics:["Finding the cashier","Asking for discounts","Product availability","Store layout"],correct:0,explanation:"The speaker is being told where the cashier is located in Polish."},{type:"missing-word",sentence:"Czy jest tu jaka ___?",options:["zni偶ka","deszcz","plecak","restauracja"],correct:0,explanation:"'Zni偶ka' means discount in Polish."}],[{type:"missing-word",sentence:"Czy mog zapaci ___?",options:["kart","serem","skrzyni","kul"],correct:0,explanation:"'Kart' means by card (credit/debit) in Polish."},{type:"tts",audioText:"Przepraszam, gdzie znajd dzia damski?",topics:["Finding departments","Asking for restrooms","Locating exits","Requesting assistance"],correct:0,explanation:"The speaker is asking for the women's department in Polish."},{type:"missing-word",sentence:"To jest za ___.",options:["drogo","fajnie","smutno","wiernie"],correct:0,explanation:"'Drogo' means expensive in Polish."},{type:"tts",audioText:"Czy macie t sukienk te偶 w niebieskim?",topics:["Asking for colors","Checking sizes","Requesting discounts","Inquiring about materials"],correct:0,explanation:"The speaker is asking if the dress comes in blue in Polish."},{type:"missing-word",sentence:"Szukam prezentu dla mojej ___.",options:["matki","ksi偶yca","myszy","czapki"],correct:0,explanation:"'Matki' means mother in Polish."}],[{type:"missing-word",sentence:"Gdzie jest ___?",options:["przymierzalnia","uniwersytet","zegar","wiczenie"],correct:0,explanation:"'Przymierzalnia' means fitting room in Polish."},{type:"tts",audioText:"Czy mo偶e mi pani pom贸c? Szukam czarnego sk贸rzanego paszcza.",topics:["Asking for assistance","Complaining about service","Returning items","Checking prices"],correct:0,explanation:"The speaker is asking for help finding a black leather coat in Polish."},{type:"missing-word",sentence:"Wezm ___ kolor.",options:["inny","stary","biedny","wszystkie"],correct:0,explanation:"'Inny' means other/different in Polish."},{type:"tts",audioText:"Godziny otwarcia s od 9 do 20.",topics:["Store hours","Sale periods","Delivery times","Return policies"],correct:0,explanation:"The sentence states store opening hours in Polish."},{type:"missing-word",sentence:"Czy mog dosta ___?",options:["paragon","meduza","藕r贸do","twar贸g"],correct:0,explanation:"'Paragon' means receipt in Polish."}]]},
hobbies: {name:"Hobbies & Leisure",icon:"fa-film",sets:[[{type:"missing-word",sentence:"Lubi gra na ___.",options:["pianinie","serze","skrzyni","kuli"],correct:0,explanation:"'Pianinie' means piano in Polish."},{type:"tts",audioText:"W sobot id do kina obejrze nowy film Marvela.",topics:["Going to the movies","Reading books","Playing sports","Cooking"],correct:0,explanation:"The speaker is going to the cinema to watch a movie in Polish."},{type:"missing-word",sentence:"Moje hobby to ___.",options:["fotografia","okno","ryba","pi贸ro"],correct:0,explanation:"'Fotografia' means photography in Polish."},{type:"tts",audioText:"Codziennie wieczorem przed snem czytam ksi偶k.",topics:["Reading","Writing","Painting","Dancing"],correct:0,explanation:"The speaker reads a book every evening before bed in Polish."},{type:"missing-word",sentence:"W weekend czsto chodz ___.",options:["na spacery","czeka","my","偶yczy"],correct:0,explanation:"'Na spacery' means for walks/hiking in Polish."}],[{type:"missing-word",sentence:"Gram w pik no偶n w ___.",options:["klubie","ruchu","rozumie","umowie"],correct:0,explanation:"'Klubie' means club/team in Polish."},{type:"tts",audioText:"M贸j ulubiony zesp贸 gra dzi wieczorem w parku.",topics:["Attending concerts","Watching sports","Visiting museums","Going to restaurants"],correct:0,explanation:"The speaker mentions their favorite band playing in the park in Polish."},{type:"missing-word",sentence:"Lubi chodzi ___.",options:["pywa","pisa","zamyka","ci"],correct:0,explanation:"'Pywa' means swimming in Polish."},{type:"tts",audioText:"W niedziel zawsze piek ciasto dla mojej rodziny.",topics:["Baking","Gardening","Painting","Playing video games"],correct:0,explanation:"The speaker bakes cake every Sunday for their family in Polish."},{type:"missing-word",sentence:"Zbieram stare ___.",options:["monety","czapki","myszy","meble"],correct:0,explanation:"'Monety' means coins in Polish."}],[{type:"missing-word",sentence:"Lubi fotografowa ___.",options:["krajobrazy","y偶k","lokal","piosenki"],correct:0,explanation:"'Krajobrazy' means landscapes in Polish."},{type:"tts",audioText:"W ka偶dy czwartek chodz na tace do domu kultury.",topics:["Dancing","Swimming","Reading","Cooking"],correct:0,explanation:"The speaker goes dancing every Thursday in Polish."},{type:"missing-word",sentence:"Gram na ___ gitarze.",options:["","","",""],correct:0,explanation:"The correct article for 'gitara' (guitar) in Polish."},{type:"tts",audioText:"W wolnym czasie maluj akwarele.",topics:["Painting","Singing","Running","Shopping"],correct:0,explanation:"The speaker paints watercolors in their free time in Polish."},{type:"missing-word",sentence:"Lubi sucha ___ muzyki.",options:["klasycznej","zimnej","zepsutej","kr贸tkiej"],correct:0,explanation:"'Klasycznej' means classical in Polish."}]]},
animals: {name:"Animals & Nature",icon:"fa-paw",sets:[[{type:"missing-word",sentence:"___ szczeka gono.",options:["Pies","Kapelusz","Dom","Rka"],correct:0,explanation:"'Pies' means dog in Polish."},{type:"tts",audioText:"W lesie jest wiele zwierzt takich jak sarny, lisy i wiewi贸rki.",topics:["City life","Forest animals","Ocean creatures","Farm animals"],correct:1,explanation:"The sentence describes forest animals in Polish."},{type:"missing-word",sentence:"___ lata wysoko na niebie.",options:["Ptak","Waza","Sdzia","Peny"],correct:0,explanation:"'Ptak' means bird in Polish."},{type:"tts",audioText:"Wiosn kwitn kwiaty, a drwewa wypuszczaj nowe licie.",topics:["Seasons","Weather","Gardening","Nature cycles"],correct:3,explanation:"The sentence describes natural cycles in spring in Polish."},{type:"missing-word",sentence:"Widz ___ w zoo.",options:["lwa","y偶k","lokal","piosenk"],correct:0,explanation:"'Lwa' means lion in Polish."}],[{type:"missing-word",sentence:"___ robi muuu.",options:["Krowa","Kot","Skrzynia","Kula"],correct:0,explanation:"'Krowa' means cow in Polish."},{type:"tts",audioText:"Na pla偶y czsto mo偶na zobaczy mewy i kraby.",topics:["Beach wildlife","Forest animals","Mountain creatures","Desert species"],correct:0,explanation:"The sentence describes animals found at the beach in Polish."},{type:"missing-word",sentence:"___ wspina si na drzewa.",options:["Mapa","Jabko","Rami","Oko"],correct:0,explanation:"'Mapa' means monkey in Polish."},{type:"tts",audioText:"Jesieni licie spadaj z drzew, a dni staj si kr贸tsze.",topics:["Autumn changes","Winter preparations","Spring renewal","Summer activities"],correct:0,explanation:"The sentence describes autumn changes in Polish."},{type:"missing-word",sentence:"___ bzyczy wok贸 kwiat贸w.",options:["Pszczoa","Banan","Nied藕wied藕","Ksi偶ka"],correct:0,explanation:"'Pszczoa' means bee in Polish."}],[{type:"missing-word",sentence:"___ ryczy gono.",options:["Tygrys","St贸","ciereczka","Garnek"],correct:0,explanation:"'Tygrys' means tiger in Polish."},{type:"tts",audioText:"Zim wiele ptak贸w odlatuje do cieplejszych kraj贸w.",topics:["Bird migration","Hibernation","Plant growth","Ocean currents"],correct:0,explanation:"The sentence describes bird migration in winter in Polish."},{type:"missing-word",sentence:"___ ma dugie uszy.",options:["Zajce","Spodnie","Dom","Rka"],correct:0,explanation:"'Zajce' means rabbits in Polish."},{type:"tts",audioText:"Wiosn wykluwaj si pisklta z jaj.",topics:["Spring hatching","Summer breeding","Autumn harvesting","Winter sleeping"],correct:0,explanation:"The sentence describes chicks hatching in spring in Polish."},{type:"missing-word",sentence:"___ 偶yje w d偶ungli.",options:["Papuga","Papier","Ko","Rolina"],correct:0,explanation:"'Papuga' means parrot in Polish."}]]},
work: {name:"Work & Office",icon:"fa-briefcase",sets:[[{type:"missing-word",sentence:"Mam ___ z moim szefem.",options:["spotkanie","n贸偶","paszcz","ksi偶yc"],correct:0,explanation:"'Spotkanie' means meeting in Polish."},{type:"tts",audioText:"Czy m贸gby mi pan wysa prezentacj mailem?",topics:["Making requests","Complaining","Socializing","Giving orders"],correct:0,explanation:"The speaker is politely requesting a presentation via email in Polish."},{type:"missing-word",sentence:"M贸j ___ jest dzi bardzo zajty.",options:["kolega","ciasto","walizka","kino"],correct:0,explanation:"'Kolega' means colleague in Polish."},{type:"tts",audioText:"Firma szuka nowych pracownik贸w do dziau marketingu.",topics:["Job hunting","Company news","Office gossip","Work complaints"],correct:0,explanation:"The sentence is about job openings in marketing in Polish."},{type:"missing-word",sentence:"Musz napisa ___.",options:["raport","pik","贸偶ko","od藕"],correct:0,explanation:"'Raport' means report in Polish."}],[{type:"missing-word",sentence:"Pracuj jako ___.",options:["in偶ynier","je偶","wyspa","pomys"],correct:0,explanation:"'In偶ynier' means engineer in Polish."},{type:"tts",audioText:"Czy m贸gby pan to powt贸rzy? Nie zrozumiaem.",topics:["Asking for clarification","Making complaints","Giving instructions","Sharing personal news"],correct:0,explanation:"The speaker is asking for repetition due to misunderstanding in Polish."},{type:"missing-word",sentence:"___ zaczyna si o 9:00.",options:["Praca","Lekarz","Rami","Oko"],correct:0,explanation:"'Praca' means work in Polish."},{type:"tts",audioText:"Musz zrobi nadgodziny, bo projekt musi by gotowy na jutro.",topics:["Working overtime","Taking vacation","Quitting job","Asking for raise"],correct:0,explanation:"The speaker mentions working overtime to meet a deadline in Polish."},{type:"missing-word",sentence:"Potrzebuj nowego ___.",options:["komputera","kuzyna","kremu","wiolonczeli"],correct:0,explanation:"'Komputera' means computer in Polish."}],[{type:"missing-word",sentence:"M贸j ___ jest chory.",options:["szef","ch贸r","chipsy","chemia"],correct:0,explanation:"'Szef' means boss in Polish."},{type:"tts",audioText:"Czy m贸gby mi pan pom贸c? Nie rozumiem tej tabeli w Excelu.",topics:["Asking for help","Complaining about software","Requesting training","Reporting bugs"],correct:0,explanation:"The speaker is asking for help with an Excel spreadsheet in Polish."},{type:"missing-word",sentence:"Mam dzi ___ wolne.",options:["urlop","zegar","uniwersytet","wiczenie"],correct:0,explanation:"'Urlop' means vacation/day off in Polish."},{type:"tts",audioText:"Konferencja odbdzie si w przyszym tygodniu w siedzibie g贸wnej.",topics:["Conference announcements","Team meetings","Client visits","Training sessions"],correct:0,explanation:"The sentence announces a conference at headquarters in Polish."},{type:"missing-word",sentence:"Musz wysa ___.",options:["e-mail","osa","truskawk","kt"],correct:0,explanation:"'E-mail' is commonly used in Polish too."}]]},
health: {name:"Health & Body",icon:"fa-heartbeat",sets:[[{type:"missing-word",sentence:"Boli mnie ___.",options:["gowa","kosz","kucharz","kapusta"],correct:0,explanation:"'Gowa' means head in Polish."},{type:"tts",audioText:"Nie czuj si dobrze. Mam gorczk i b贸l garda.",topics:["Describing symptoms","Making plans","Talking about food","Discussing weather"],correct:0,explanation:"The speaker is describing illness symptoms in Polish."},{type:"missing-word",sentence:"Prosz bra ___ tabletki trzy razy dziennie.",options:["te","ten","to","tego"],correct:0,explanation:"'Te' is the correct demonstrative for plural 'tabletki' in Polish."},{type:"tts",audioText:"Sport jest dobry dla zdrowia. Biegam codziennie.",topics:["Exercise benefits","Diet advice","Medical procedures","Sleep habits"],correct:0,explanation:"The speaker talks about exercise benefits in Polish."},{type:"missing-word",sentence:"Id do ___.",options:["lekarza","samochodu","jabka","oka"],correct:0,explanation:"'Lekarza' means doctor in Polish."}],[{type:"missing-word",sentence:"Mam silny ___ b贸l.",options:["brzucha","ksi偶ki","贸偶ka","odzi"],correct:0,explanation:"'Brzucha' means stomach in Polish."},{type:"tts",audioText:"Potrzebuj recepty na antybiotyk.",topics:["Requesting medication","Asking for test results","Scheduling appointments","Discussing diet"],correct:0,explanation:"The speaker needs a prescription for antibiotics in Polish."},{type:"missing-word",sentence:"Moje ___ koacze.",options:["serce","koszula","pies","dom"],correct:0,explanation:"'Serce' means heart in Polish."},{type:"tts",audioText:"Powinienem pi wicej wody, a mniej kawy.",topics:["Hydration advice","Sleep recommendations","Exercise routines","Medication schedules"],correct:0,explanation:"The speaker discusses drinking more water and less coffee in Polish."},{type:"missing-word",sentence:"Mam ___ wizyt.",options:["lekarsk","samochodow","jabkow","oczn"],correct:0,explanation:"'Lekarsk' means doctor's in Polish."}],[{type:"missing-word",sentence:"Swdzi mnie ___.",options:["rami","jabko","samoch贸d","oko"],correct:0,explanation:"'Rami' means arm in Polish."},{type:"tts",audioText:"Musz bra leki o 8 rano.",topics:["Medication schedule","Diet plan","Exercise routine","Sleep schedule"],correct:0,explanation:"The speaker mentions taking medication at 8 AM in Polish."},{type:"missing-word",sentence:"Czuj si ___.",options:["zmczony","agodny","chudy","rzeki"],correct:0,explanation:"'Zmczony' means tired in Polish."},{type:"tts",audioText:"Mam od dw贸ch dni biegunk i wymioty.",topics:["Describing severe symptoms","Reporting minor aches","Discussing allergies","Talking about sleep"],correct:0,explanation:"The speaker describes severe gastrointestinal symptoms in Polish."},{type:"missing-word",sentence:"Potrzebuj ___ odpoczynku.",options:["wicej","m贸j","najczciej","porodku"],correct:0,explanation:"'Wicej' means more in Polish."}]]},
school: {name:"School & Education",icon:"fa-graduation-cap",sets:[[{type:"missing-word",sentence:"___ zaczyna si o 8:00.",options:["Szkoa","But","W偶","Miska"],correct:0,explanation:"'Szkoa' means school in Polish."},{type:"tts",audioText:"Na egzamin musimy si nauczy rozdzia贸w 1 do 5.",topics:["Exam preparation","Homework complaints","Teacher praise","Classroom rules"],correct:0,explanation:"The speaker is talking about exam preparation in Polish."},{type:"missing-word",sentence:"Dostaem dobr ___ z matematyki.",options:["ocen","nos","noc","numer"],correct:0,explanation:"'Ocen' means grade/mark in Polish."},{type:"tts",audioText:"Na przerwie gramy w pik na boisku szkolnym.",topics:["Recess activities","Classroom lessons","Homework","After-school clubs"],correct:0,explanation:"The sentence describes recess activities in Polish."},{type:"missing-word",sentence:"M贸j ___ pomaga mi w zadaniach.",options:["nauczyciel","y偶ka","lokal","piosenka"],correct:0,explanation:"'Nauczyciel' means teacher in Polish."}],[{type:"missing-word",sentence:"Chodz do ___ klasy.",options:["贸smej","starej","biednej","wszystkich"],correct:0,explanation:"'smej' means eighth (as in 8th grade) in Polish."},{type:"tts",audioText:"Zadanie domowe na jutro jest na stronie 45, zadanie 3.",topics:["Homework assignments","Test announcements","Field trip details","Club meeting times"],correct:0,explanation:"The speaker gives homework instructions in Polish."},{type:"missing-word",sentence:"Mamy dzi ___ lekcj.",options:["muzyki","matki","usty","myszy"],correct:0,explanation:"'Muzyki' means music in Polish."},{type:"tts",audioText:"Sprawdzian z historii by bardzo trudny.",topics:["Test difficulty","Homework load","Teacher behavior","Classroom environment"],correct:0,explanation:"The speaker comments on a difficult history test in Polish."},{type:"missing-word",sentence:"Potrzebuj nowego ___ zeszytu.",options:["matematycznego","matczynego","ustnego","mysiego"],correct:0,explanation:"'Matematycznego' means math in Polish."}],[{type:"missing-word",sentence:"___ dzwoni o 12:00.",options:["Przerwa","Lalka","Patelnia","Rolina"],correct:0,explanation:"'Przerwa' means break/recess in Polish."},{type:"tts",audioText:"Nasz nauczyciel fizyki zawsze bardzo przejrzycie tumaczy eksperymenty.",topics:["Teacher praise","Subject complaints","Homework issues","Classroom rules"],correct:0,explanation:"The speaker praises their physics teacher's explanations in Polish."},{type:"missing-word",sentence:"Ucz si na ___ egzamin.",options:["kocowy","jabko","samoch贸d","oko"],correct:0,explanation:"'Kocowy' means final exam in Polish."},{type:"tts",audioText:"W bibliotece trzeba by cicho.",topics:["Library rules","Classroom behavior","Cafeteria etiquette","Playground safety"],correct:0,explanation:"The sentence states a library rule about being quiet in Polish."},{type:"missing-word",sentence:"M贸j ___ przedmiot to biologia.",options:["ulubiony","dugi","gony","pusty"],correct:0,explanation:"'Ulubiony' means favorite in Polish."}]]},
cities: {name:"Cities & Places",icon:"fa-city",sets:[[{type:"missing-word",sentence:"Warszawa jest ___ Polski.",options:["stolic","dworcem","g贸wn ulic","bram"],correct:0,explanation:"'Stolic' means capital city in Polish."},{type:"tts",audioText:"W Krakowie jest synny Wawel i pikny rynek.",topics:["City attractions","Country comparisons","Rural life","Transport systems"],correct:0,explanation:"The sentence describes attractions in Krakow in Polish."},{type:"missing-word",sentence:"___ jest bardzo stare i historyczne.",options:["Zamek","But","W偶","Miska"],correct:0,explanation:"'Zamek' means castle in Polish."},{type:"tts",audioText:"Stare Miasto w Gdasku jest znane z piknej architektury.",topics:["Historic districts","Modern architecture","Industrial areas","Suburban life"],correct:0,explanation:"The sentence describes Gdask's historic old town in Polish."},{type:"missing-word",sentence:"Odwiedzam ___ w weekend.",options:["muzeum","ksi偶yc","mysz","czapk"],correct:0,explanation:"'Muzeum' means museum in Polish."}],[{type:"missing-word",sentence:"Gdask ma du偶y ___ port.",options:["morski","but","w偶","miska"],correct:0,explanation:"'Morski' means seaport in Polish."},{type:"tts",audioText:"We Wrocawiu jest wiele krasnali i pikny rynek.",topics:["City skylines","Historical sites","Natural landscapes","Rural villages"],correct:0,explanation:"The sentence describes Wrocaw's attractions in Polish."},{type:"missing-word",sentence:"W Poznaniu s synne ___ kozioki.",options:["poznaskie","zimne","mae","krzywe"],correct:0,explanation:"'Poznaskie' refers to the famous Pozna goats in Polish."},{type:"tts",audioText:"Zakopane jest nazywane zimow stolic Polski.",topics:["Architectural nicknames","Industrial cities","Mountain towns","Coastal resorts"],correct:0,explanation:"The sentence explains Zakopane's nickname in Polish."},{type:"missing-word",sentence:"W ___ jest synna panorama racawicka.",options:["Wrocawiu","Wsi","Dachu","Suficie"],correct:0,explanation:"The Panorama Racawicka is a famous painting in Wrocaw."}],[{type:"missing-word",sentence:"___ to najdu偶sza ulica w Warszawie.",options:["Marszakowska","Podkoszulek","Podkadka","Zakwaterowanie"],correct:0,explanation:"'Marszakowska' is a famous street in Warsaw."},{type:"tts",audioText:"Mazury to popularny region turystyczny na p贸nocnym wschodzie Polski.",topics:["Tourist regions","Urban centers","Industrial zones","Coastal areas"],correct:0,explanation:"The sentence describes the Masurian Lake District in Polish."},{type:"missing-word",sentence:"___ jest najwikszym jeziorem w Polsce.",options:["niardwy","Podoga","贸d藕","Ksi偶ka"],correct:0,explanation:"'niardwy' is the largest lake in Poland."},{type:"tts",audioText:"Rysy to najwy偶szy szczyt Polski i znajduje si w Tatrach.",topics:["Mountains","Rivers","Forests","Deserts"],correct:0,explanation:"The sentence identifies Poland's highest mountain in Polish."},{type:"missing-word",sentence:"Wisa to wa偶na ___ w Europie.",options:["rzeka","ryba","skaa","pole"],correct:0,explanation:"'Rzeka' means river in Polish."}]]}
};

// Track last used sets per topic to ensure variety
let topicSetHistory = JSON.parse(localStorage.getItem('terazPolskiSetHistory')) || {};

// Shuffle array helper function
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Randomize correct answer position
function randomizeOptions(options, correctIndex) {
    const correctAnswer = options[correctIndex];
    const incorrectAnswers = options.filter((_, i) => i !== correctIndex);
    const shuffledIncorrect = shuffleArray(incorrectAnswers);
    
    const correctPos = Math.floor(Math.random() * options.length);
    const newOptions = [];
    let incorrectIndex = 0;
    
    for (let i = 0; i < options.length; i++) {
        if (i === correctPos) {
            newOptions.push(correctAnswer);
        } else {
            newOptions.push(shuffledIncorrect[incorrectIndex++]);
        }
    }
    
    return { 
        options: newOptions, 
        correctIndex: newOptions.indexOf(correctAnswer) 
    };
}

// Select a random set that hasn't been used recently
function selectRandomSet(topicKey) {
    const sets = allTopics[topicKey].sets;
    const numSets = sets.length;
    
    // Initialize history if needed
    if (!topicSetHistory[topicKey]) {
        topicSetHistory[topicKey] = [];
    }
    
    // Get available sets (not in last 2 used)
    const availableSets = [];
    for (let i = 0; i < numSets; i++) {
        if (!topicSetHistory[topicKey].slice(-2).includes(i)) {
            availableSets.push(i);
        }
    }
    
    // If all sets were recently used, reset history
    if (availableSets.length === 0) {
        topicSetHistory[topicKey] = [];
        for (let i = 0; i < numSets; i++) {
            availableSets.push(i);
        }
    }
    
    // Select random from available
    const randomIndex = availableSets[Math.floor(Math.random() * availableSets.length)];
    
    // Update history
    topicSetHistory[topicKey].push(randomIndex);
    localStorage.setItem('terazPolskiSetHistory', JSON.stringify(topicSetHistory));
    
    return randomIndex;
}

// Scroll to next button smoothly
function scrollToNextButton() {
  setTimeout(() => {
    const nextBtn = document.querySelector('.btn-next');
    if (nextBtn) {
      nextBtn.scrollIntoView({
        behavior: 'smooth',
        block: 'center',
        inline: 'nearest'
      });
      setTimeout(() => nextBtn.focus(), 300);
    }
  }, 150);
}

// App state
let currentTopic = null;
let currentExercise = 0;
let points = 0;
let userAnswers = [];
let speechSynthesis = window.speechSynthesis;
let isDarkMode = localStorage.getItem('darkMode') === 'true';
let topicBestScores = JSON.parse(localStorage.getItem('terazPolskiBestScores')) || {};
let currentSetIndex = null;

// DOM elements
const exerciseContainer = document.getElementById('exercise-container');
const progressContainer = document.getElementById('progress-container');
const progressFill = document.getElementById('progress-fill');
const progressText = document.getElementById('progress-text');
const pointsDisplay = document.getElementById('points');
const completionScreen = document.getElementById('completion-screen');
const finalScore = document.getElementById('final-score');
const completionMessage = document.getElementById('completion-message');
const topicSelectionScreen = document.getElementById('topic-selection-screen');
const topicOptionsContainer = document.getElementById('topic-options-container');
const themeToggle = document.getElementById('theme-toggle');
const newTopicBtn = document.getElementById('new-topic-btn');
const restartTopicBtn = document.getElementById('restart-topic-btn');

// Set initial theme
applyTheme();

// Toggle dark mode
themeToggle.addEventListener('click', () => {
    isDarkMode = !isDarkMode;
    localStorage.setItem('darkMode', isDarkMode);
    applyTheme();
    
    const icon = themeToggle.querySelector('i');
    icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
});

function applyTheme() {
    const root = document.documentElement;
    if (isDarkMode) {
        root.style.setProperty('--bg', 'var(--dark-bg)');
        root.style.setProperty('--text', 'var(--text-dark)');
        root.style.setProperty('--card', 'var(--card-dark)');
        root.style.setProperty('--border', 'var(--border-dark)');
        root.style.setProperty('--option-bg', 'var(--option-bg-dark)');
        root.style.setProperty('--bg-sentence', 'rgba(30, 41, 59, 0.7)');
        root.style.setProperty('--shadow', 'var(--shadow-dark)');
        root.style.setProperty('--feedback-correct', 'var(--feedback-correct-dark)');
        root.style.setProperty('--feedback-correct-text', 'white');
        root.style.setProperty('--feedback-incorrect', 'var(--feedback-incorrect-dark)');
        root.style.setProperty('--feedback-incorrect-text', 'white');
        root.style.setProperty('--warning', '#fbbf24');
    } else {
        root.style.setProperty('--bg', 'var(--light-bg)');
        root.style.setProperty('--text', 'var(--text-light)');
        root.style.setProperty('--card', 'var(--card-light)');
        root.style.setProperty('--border', 'var(--border-light)');
        root.style.setProperty('--option-bg', 'var(--option-bg-light)');
        root.style.setProperty('--bg-sentence', '#f1f5ff');
        root.style.setProperty('--shadow', 'var(--shadow-light)');
        root.style.setProperty('--feedback-correct', 'var(--feedback-correct-light)');
        root.style.setProperty('--feedback-correct-text', 'var(--text-light)');
        root.style.setProperty('--feedback-incorrect', 'var(--feedback-incorrect-light)');
        root.style.setProperty('--feedback-incorrect-text', 'var(--text-light)');
        root.style.setProperty('--warning', '#f8961e');
    }
}

// Initialize the app
function initApp() {
    renderTopicSelection();
    
    newTopicBtn.addEventListener('click', showTopicSelection);
    restartTopicBtn.addEventListener('click', () => startTopicExercises(currentTopic));
}

// Render topic selection screen
function renderTopicSelection() {
    topicOptionsContainer.innerHTML = '';
    
    Object.keys(allTopics).forEach(topicKey => {
        const topic = allTopics[topicKey];
        const bestScore = topicBestScores[topicKey] || 0;
        
        const topicOption = document.createElement('div');
        topicOption.className = 'topic-option';
        topicOption.dataset.topic = topicKey;
        topicOption.innerHTML = `
            <i class="fas ${topic.icon}"></i>
            ${topic.name}
            ${bestScore > 0 ? `<div class="score-badge">${Math.round(bestScore)}</div>` : ''}
        `;
        
        topicOption.addEventListener('click', () => startTopicExercises(topicKey));
        topicOptionsContainer.appendChild(topicOption);
    });
}

// Start topic exercises
function startTopicExercises(topicKey) {
    topicSelectionScreen.classList.add('hidden');
    progressContainer.classList.remove('hidden');
    exerciseContainer.classList.remove('hidden');
    completionScreen.classList.add('hidden');
    
    currentTopic = topicKey;
    currentExercise = 0;
    points = 0;
    
    // GUARANTEED NEW SET EVERY TIME
    currentSetIndex = selectRandomSet(topicKey);
    const exercises = allTopics[topicKey].sets[currentSetIndex];
    userAnswers = new Array(exercises.length).fill(null);
    
    pointsDisplay.textContent = points;
    updateProgress();
    loadExercise(currentExercise);
}

// Load and display current exercise
function loadExercise(index) {
    const topicData = allTopics[currentTopic];
    const exercises = topicData.sets[currentSetIndex];
    const exercise = exercises[index];
    exerciseContainer.innerHTML = '';
    
    const titleContainer = document.createElement('div');
    titleContainer.className = 'exercise-title';
    titleContainer.innerHTML = `
        <span><i class="fas fa-${exercise.type === 'missing-word' ? 'puzzle-piece' : 'headphones'}"></i> ${exercise.type === 'missing-word' ? 'Fill in the Blank' : 'Listen & Identify Topic'}</span>
        <div>
            <span class="topic-name">${topicData.name}</span>
            <button class="back-btn" id="back-to-topics-btn">
                <i class="fas fa-arrow-left"></i> Topics
            </button>
        </div>
    `;
    exerciseContainer.appendChild(titleContainer);
    
    setTimeout(() => {
        const backBtn = document.getElementById('back-to-topics-btn');
        if (backBtn) {
            backBtn.addEventListener('click', showTopicSelection);
        }
    }, 0);
    
    if (exercise.type === 'missing-word') {
        const randomized = randomizeOptions(exercise.options, exercise.correct);
        exercise.currentOptions = randomized.options;
        exercise.currentCorrect = randomized.correctIndex;
    }
    
    if (exercise.type === 'tts') {
        const topics = [...exercise.topics];
        const correctTopic = topics[exercise.correct];
        const shuffledTopics = shuffleArray(topics);
        const newCorrectIndex = shuffledTopics.indexOf(correctTopic);
        
        exercise.currentTopics = shuffledTopics;
        exercise.currentCorrect = newCorrectIndex;
    }
    
    if (exercise.type === 'missing-word') {
        renderMissingWordExercise(exercise, exercises);
    } else if (exercise.type === 'tts') {
        renderTTsExercise(exercise);
    }
}

// Render missing word exercise
function renderMissingWordExercise(exercise, exercises) {
    const content = document.createElement('div');
    content.className = 'exercise-content missing-word-exercise';
    
    const sentence = document.createElement('div');
    sentence.className = 'sentence';
    sentence.textContent = exercise.sentence;
    content.appendChild(sentence);
    
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'options-container';
    
    const options = exercise.currentOptions;
    const correctIndex = exercise.currentCorrect;
    
    options.forEach((option, index) => {
        const optionBtn = document.createElement('button');
        optionBtn.className = 'option-btn';
        optionBtn.textContent = option;
        optionBtn.dataset.index = index;
        
        if (userAnswers[currentExercise] !== undefined && userAnswers[currentExercise] !== null) {
            optionBtn.disabled = true;
            if (index === userAnswers[currentExercise]) {
                optionBtn.classList.add('selected');
                if (index === correctIndex) {
                    optionBtn.classList.add('correct');
                } else {
                    optionBtn.classList.add('incorrect');
                }
            } else if (index === correctIndex) {
                optionBtn.classList.add('correct');
            }
        }
        
        optionBtn.addEventListener('click', () => handleMissingWordAnswer(index, correctIndex, exercise, exercises));
        optionsContainer.appendChild(optionBtn);
    });
    
    content.appendChild(optionsContainer);
    
    const feedback = document.createElement('div');
    feedback.className = 'feedback';
    feedback.id = 'feedback';
    content.appendChild(feedback);
    
    exerciseContainer.appendChild(content);
    addNavigation();
}

// Handle missing word answer
function handleMissingWordAnswer(selectedIndex, correctIndex, exercise, exercises) {
    userAnswers[currentExercise] = selectedIndex;
    
    if (selectedIndex === correctIndex) {
        points += 10;
        pointsDisplay.textContent = points;
    }
    
    const buttons = document.querySelectorAll('.option-btn');
    buttons.forEach((btn, index) => {
        btn.disabled = true;
        if (index === selectedIndex) {
            btn.classList.add('selected');
            if (index === correctIndex) {
                btn.classList.add('correct');
            } else {
                btn.classList.add('incorrect');
            }
        } else if (index === correctIndex) {
            btn.classList.add('correct');
        }
    });
    
    const feedback = document.getElementById('feedback');
    if (selectedIndex === correctIndex) {
        feedback.textContent = `Correct! ${exercise.explanation}`;
        feedback.className = 'feedback correct';
        const fullCorrectSentence = exercise.sentence.replace("___", exercise.options[exercise.correct]);
        setTimeout(() => speakText(fullCorrectSentence), 500);
    } else {
        feedback.textContent = `Incorrect. ${exercise.explanation}`;
        feedback.className = 'feedback incorrect';
        const fullCorrectSentence = exercise.sentence.replace("___", exercise.options[exercise.correct]);
        setTimeout(() => speakText(fullCorrectSentence), 1000);
    }
    
    document.querySelector('.btn-next').disabled = false;
    
    // SCROLL TO NEXT BUTTON
    scrollToNextButton();
}

// Render TTS exercise
function renderTTsExercise(exercise) {
    const content = document.createElement('div');
    content.className = 'exercise-content tts-exercise';
    
    const instruction = document.createElement('p');
    instruction.textContent = 'Listen to the Polish sentence and select the correct topic:';
    instruction.style.marginBottom = '20px';
    instruction.style.fontSize = '1.1rem';
    content.appendChild(instruction);
    
    const audioControls = document.createElement('div');
    audioControls.className = 'audio-controls';
    
    const playBtn = document.createElement('button');
    playBtn.className = 'play-btn';
    playBtn.innerHTML = '<i class="fas fa-play"></i>';
    playBtn.title = 'Play audio';
    
    playBtn.addEventListener('click', () => {
        speakText(exercise.audioText);
        playBtn.disabled = true;
        setTimeout(() => {
            playBtn.disabled = false;
        }, 5000);
    });
    
    audioControls.appendChild(playBtn);
    content.appendChild(audioControls);
    
    const topicsContainer = document.createElement('div');
    topicsContainer.className = 'topics-container';
    
    const topics = exercise.currentTopics;
    const correctIndex = exercise.currentCorrect;
    
    topics.forEach((topic, index) => {
        const topicCard = document.createElement('div');
        topicCard.className = 'topic-card';
        topicCard.textContent = topic;
        topicCard.dataset.index = index;
        
        if (userAnswers[currentExercise] !== undefined && userAnswers[currentExercise] !== null) {
            topicCard.classList.add('locked');
            if (index === userAnswers[currentExercise]) {
                topicCard.classList.add('selected');
            }
            if (userAnswers[currentExercise] !== correctIndex && index === correctIndex) {
                topicCard.classList.add('correct');
            }
        }
        
        topicCard.addEventListener('click', () => handleTTSAnswer(index, correctIndex, exercise));
        topicsContainer.appendChild(topicCard);
    });
    
    content.appendChild(topicsContainer);
    
    const feedback = document.createElement('div');
    feedback.className = 'feedback';
    feedback.id = 'feedback';
    content.appendChild(feedback);
    
    exerciseContainer.appendChild(content);
    addNavigation();
}

// Handle TTS answer
function handleTTSAnswer(selectedIndex, correctIndex, exercise) {
    userAnswers[currentExercise] = selectedIndex;
    
    if (selectedIndex === correctIndex) {
        points += 10;
        pointsDisplay.textContent = points;
    }
    
    const cards = document.querySelectorAll('.topic-card');
    cards.forEach((card, index) => {
        card.classList.add('locked');
        if (index === selectedIndex) {
            card.classList.add('selected');
        }
        if (index === correctIndex) {
            card.classList.add('correct');
        }
    });
    
    const feedback = document.getElementById('feedback');
    if (selectedIndex === correctIndex) {
        feedback.textContent = `Correct! ${exercise.explanation}`;
        feedback.className = 'feedback correct';
    } else {
        feedback.textContent = `Incorrect. ${exercise.explanation}`;
        feedback.className = 'feedback incorrect';
    }
    
    document.querySelector('.btn-next').disabled = false;
    
    // SCROLL TO NEXT BUTTON
    scrollToNextButton();
}

// Text-to-speech function
function speakText(text) {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pl-PL';
    utterance.rate = 0.9;
    utterance.pitch = 1;
    speechSynthesis.speak(utterance);
}

// Add navigation buttons
function addNavigation() {
    const nav = document.createElement('div');
    nav.className = 'navigation';
    
    const prevBtn = document.createElement('button');
    prevBtn.className = 'btn btn-prev';
    prevBtn.textContent = 'Previous';
    prevBtn.disabled = currentExercise === 0;
    prevBtn.addEventListener('click', () => {
        if (currentExercise > 0) {
            currentExercise--;
            loadExercise(currentExercise);
            updateProgress();
        }
    });
    
    const nextBtn = document.createElement('button');
    nextBtn.className = 'btn btn-next';
    nextBtn.textContent = currentExercise === 4 ? 'Finish Topic' : 'Next';
    nextBtn.disabled = userAnswers[currentExercise] === undefined || userAnswers[currentExercise] === null;
    nextBtn.addEventListener('click', () => {
        if (currentExercise < 4) {
            currentExercise++;
            loadExercise(currentExercise);
            updateProgress();
        } else {
            finishTopic();
        }
    });
    
    nav.appendChild(prevBtn);
    nav.appendChild(nextBtn);
    exerciseContainer.appendChild(nav);
}

// Update progress bar and text
function updateProgress() {
    const totalExercises = 5;
    const progress = ((currentExercise + 1) / totalExercises) * 100;
    progressFill.style.width = `${progress}%`;
    progressText.textContent = `${currentExercise + 1}/${totalExercises}`;
}

// Finish topic and save score
function finishTopic() {
  if (points > (topicBestScores[currentTopic] || 0)) {
    topicBestScores[currentTopic] = points;
    localStorage.setItem('terazPolskiBestScores', JSON.stringify(topicBestScores));
  }

  let message = "Keep practicing! ";
  let color = "#f8961e";
  if (points >= 45) {
    message = "Outstanding! ";
    color = "#4ade80";
  } else if (points >= 35) {
    message = "Great job! ";
    color = "#4cc9f0";
  } else if (points >= 25) {
    message = "Good effort! ";
    color = "#f8961e";
  }

  completionMessage.textContent = message;
  completionMessage.style.color = color;

  exerciseContainer.classList.add('hidden');
  progressContainer.classList.add('hidden');
  finalScore.textContent = points;
  completionScreen.classList.remove('hidden');
}

// Show topic selection screen
function showTopicSelection() {
    completionScreen.classList.add('hidden');
    exerciseContainer.classList.add('hidden');
    progressContainer.classList.add('hidden');
    topicSelectionScreen.classList.remove('hidden');
    renderTopicSelection();
}

// Initialize the app when page loads
window.addEventListener('load', initApp);
</script>
</body>
</html>