<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teraz Polski - Nauka jzyka polskiego</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
:root {
--primary: #4361ee;
--secondary: #3f37c9;
--success: #4cc9f0;
--light-bg: #f8f9fa;
--dark-bg: #121826;
--card-light: #ffffff;
--card-dark: #1e293b;
--text-light: #212529;
--text-dark: #f1f5f9;
--shadow-light: rgba(0, 0, 0, 0.1);
--shadow-dark: rgba(0, 0, 0, 0.3);
--border-light: #dee2e6;
--border-dark: #334155;
--option-bg-light: white;
--option-bg-dark: #334155;
--correct: #4ade80;
--incorrect: #f87171;
--feedback-correct-light: #d1fae5;
--feedback-correct-dark: #064e3b;
--feedback-incorrect-light: #fee2e2;
--feedback-incorrect-dark: #7f1d1d;
--score-badge-bg: #fbbf24;
--score-badge-text: #1e293b;
}
body {
background: var(--bg);
color: var(--text);
min-height: 100vh;
padding: 20px;
transition: background-color 0.3s, color 0.3s;
}
.container {
max-width: 900px;
margin: 0 auto;
}
header {
text-align: center;
padding: 20px 0;
margin-bottom: 30px;
display: flex;
justify-content: space-between;
align-items: center;
}
.logo-container {
text-align: center;
flex: 1;
}
h1 {
font-size: 2.5rem;
color: var(--primary);
margin-bottom: 10px;
text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}
.subtitle {
color: var(--secondary);
font-size: 1.1rem;
max-width: 600px;
margin: 0 auto;
}
.theme-toggle {
background: var(--card);
border: 1px solid var(--border);
width: 50px;
height: 50px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
box-shadow: 0 2px 6px var(--shadow);
transition: all 0.3s;
}
.theme-toggle:hover {
transform: rotate(20deg);
}
.progress-container {
background: var(--card);
border-radius: 12px;
padding: 20px;
box-shadow: 0 4px 12px var(--shadow);
margin-bottom: 30px;
border: 1px solid var(--border);
}
.progress-header {
display: flex;
justify-content: space-between;
margin-bottom: 10px;
font-weight: 600;
color: var(--secondary);
}
.progress-bar {
height: 12px;
background: var(--option-bg);
border-radius: 6px;
overflow: hidden;
border: 1px solid var(--border);
}
.progress-fill {
height: 100%;
background: linear-gradient(90deg, var(--primary), var(--success));
border-radius: 6px;
width: 0%;
transition: width 0.5s ease;
}
.points-display {
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
margin-top: 15px;
font-size: 1.2rem;
font-weight: 700;
color: var(--warning);
}
.exercise-container {
background: var(--card);
border-radius: 12px;
padding: 30px;
box-shadow: 0 4px 12px var(--shadow);
margin-bottom: 30px;
min-height: 300px;
display: flex;
flex-direction: column;
border: 1px solid var(--border);
}
.exercise-title {
font-size: 1.5rem;
margin-bottom: 20px;
color: var(--secondary);
display: flex;
align-items: center;
gap: 10px;
justify-content: space-between;
}
.topic-name {
font-weight: 600;
color: var(--primary);
}
.back-btn {
background: none;
border: none;
color: var(--secondary);
font-weight: 600;
cursor: pointer;
display: flex;
align-items: center;
gap: 5px;
}
.back-btn:hover {
color: var(--primary);
}
.exercise-content {
flex: 1;
display: flex;
flex-direction: column;
justify-content: center;
}
.missing-word-exercise {
text-align: center;
}
.sentence {
font-size: 1.4rem;
line-height: 1.6;
margin-bottom: 25px;
padding: 15px;
background: var(--bg-sentence);
border-radius: 8px;
border-left: 4px solid var(--primary);
}
.options-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
gap: 12px;
margin-top: 20px;
}
.option-btn {
padding: 12px 15px;
border: 2px solid var(--border);
border-radius: 8px;
background: var(--option-bg);
font-size: 1.1rem;
cursor: pointer;
transition: all 0.2s;
font-weight: 600;
color: var(--text);
}
.option-btn:hover:not(:disabled) {
border-color: var(--primary);
transform: translateY(-2px);
box-shadow: 0 4px 8px var(--shadow);
}
.option-btn:disabled {
opacity: 0.8;
cursor: not-allowed;
}
.option-btn.selected {
background: var(--primary);
color: white;
border-color: var(--primary);
}
.option-btn.correct {
background: var(--correct);
border-color: var(--correct);
color: white;
}
.option-btn.incorrect {
background: var(--incorrect);
border-color: var(--incorrect);
color: white;
}
.tts-exercise {
text-align: center;
}
.audio-controls {
display: flex;
justify-content: center;
gap: 15px;
margin: 25px 0;
}
.play-btn {
width: 60px;
height: 60px;
border-radius: 50%;
background: var(--primary);
color: white;
border: none;
font-size: 1.5rem;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 4px 12px var(--shadow);
transition: all 0.2s;
}
.play-btn:hover {
background: var(--secondary);
transform: scale(1.05);
}
.play-btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none;
}
.topics-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-top: 20px;
}
.topic-card {
padding: 20px;
border: 2px solid var(--border);
border-radius: 10px;
background: var(--option-bg);
cursor: pointer;
transition: all 0.2s;
text-align: center;
font-weight: 600;
color: var(--text);
}
.topic-card:hover:not(.selected):not(.locked) {
border-color: var(--primary);
transform: translateY(-3px);
box-shadow: 0 4px 8px var(--shadow);
}
.topic-card.selected {
background: var(--primary);
color: white;
border-color: var(--primary);
}
.topic-card.locked {
opacity: 0.8;
cursor: not-allowed;
}
.feedback {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
text-align: center;
font-weight: 600;
display: none;
}
.feedback.correct {
background: var(--feedback-correct);
color: var(--feedback-correct-text);
display: block;
}
.feedback.incorrect {
background: var(--feedback-incorrect);
color: var(--feedback-incorrect-text);
display: block;
}
.navigation {
display: flex;
justify-content: space-between;
margin-top: 20px;
}
.btn {
padding: 12px 25px;
border: none;
border-radius: 8px;
font-size: 1.1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}
.btn-prev {
background: var(--border);
color: var(--text);
}
.btn-prev:hover {
background: var(--primary);
color: white;
}
.btn-next {
background: var(--primary);
color: white;
}
.btn-next:hover {
background: var(--secondary);
}
.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
}
.completion-screen, .topic-selection-screen {
text-align: center;
padding: 40px 20px;
}
.completion-screen h2, .topic-selection-screen h2 {
font-size: 2.2rem;
margin-bottom: 20px;
}
.final-score {
font-size: 1.8rem;
font-weight: 700;
color: var(--warning);
margin: 20px 0;
}
.action-buttons {
margin-top: 25px;
display: flex;
justify-content: center;
gap: 15px;
flex-wrap: wrap;
}
.restart-btn, .continue-btn, .new-topic-btn, .full-restart-btn {
background: var(--success);
color: white;
padding: 12px 25px;
border: none;
border-radius: 8px;
font-size: 1.1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s;
}
.restart-btn:hover, .continue-btn:hover, .new-topic-btn:hover, .full-restart-btn:hover {
background: #3ab7e4;
transform: scale(1.03);
}
.topic-options {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
gap: 20px;
margin-top: 30px;
}
.topic-option {
padding: 25px 15px;
background: var(--card);
border: 2px solid var(--border);
border-radius: 12px;
cursor: pointer;
transition: all 0.3s;
font-weight: 600;
color: var(--text);
position: relative;
}
.topic-option:hover {
border-color: var(--primary);
transform: translateY(-5px);
box-shadow: 0 6px 12px var(--shadow);
}
.topic-option i {
display: block;
font-size: 2rem;
margin-bottom: 10px;
color: var(--primary);
}
.score-badge {
position: absolute;
top: 10px;
right: 10px;
background: var(--score-badge-bg);
color: var(--score-badge-text);
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.8rem;
font-weight: bold;
box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.hidden {
display: none;
}
@media (max-width: 600px) {
.exercise-container {
padding: 20px;
}
h1 {
font-size: 2rem;
}
.sentence {
font-size: 1.2rem;
}
.options-container, .topics-container, .topic-options {
grid-template-columns: 1fr;
}
header {
flex-direction: column;
gap: 15px;
}
.score-badge {
width: 24px;
height: 24px;
font-size: 0.7rem;
}
.action-buttons {
gap: 10px;
}
.restart-btn, .new-topic-btn {
padding: 10px 20px;
font-size: 1rem;
}
}
</style>
</head>
<body>
<div class="container">
<header>
<div class="logo-container">
<h1><i class="fas fa-language"></i> Teraz Polski</h1>
<p class="subtitle">Ucz si polskiego poprzez interaktywne wiczenia. Idealne dla pocztkujcych i rednio zaawansowanych!</p>
</div>
<div class="theme-toggle" id="theme-toggle">
<i class="fas fa-moon"></i>
</div>
</header>
<div class="progress-container hidden" id="progress-container">
<div class="progress-header">
<span>Postp</span>
<span id="progress-text">0/5</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progress-fill"></div>
</div>
<div class="points-display">
<i class="fas fa-star"></i>
<span id="points">0</span> Punkt贸w
</div>
</div>
<div class="exercise-container hidden" id="exercise-container">
<!-- Exercises will be loaded here -->
</div>
<div class="completion-screen hidden" id="completion-screen">
<h2 id="completion-message">wietna robota! </h2>
<p>Ukoczye temat!</p>
<div class="final-score">Tw贸j wynik: <span id="final-score">0</span>/50 punkt贸w</div>
<div class="action-buttons">
<button class="new-topic-btn" id="new-topic-btn">Wybierz inny temat</button>
<button class="restart-btn" id="restart-topic-btn">Powt贸rz ten temat</button>
</div>
</div>
<div class="topic-selection-screen" id="topic-selection-screen">
<h2>Wybierz temat do nauki</h2>
<p>Wybierz dowolny temat, aby rozpocz nauk jzyka polskiego!</p>
<div class="topic-options" id="topic-options-container">
<!-- Topics will be populated here -->
</div>
</div>
</div>
<script>
// All 10 topics with 3 sets of 5 exercises each - POLISH CONTENT
const allTopics = {
food: {name:"Jedzenie & Restauracje",icon:"fa-utensils",sets:[[{type:"missing-word",sentence:"Poprosz butelk ___.",options:["wody","domu","samochodu","krzesa"],correct:0,explanation:"'Wody' (water) to popularny nap贸j w zam贸wieniach."},{type:"tts",audioText:"Zupa jest wymienita! Czy mo偶emy poprosi o rachunek?",topics:["Narzekanie","Chwalenie jedzenia","Pytanie o drog","Zamawianie ubra"],correct:1,explanation:"M贸wca chwali zup i prosi o rachunek."},{type:"missing-word",sentence:"Ile kosztuje ___?",options:["menu","ksi偶yc","mysz","czapka"],correct:0,explanation:"'Menu' oznacza kart da w restauracji."},{type:"tts",audioText:"Jestem wegetarianinem. Czy macie dania wegetariaskie?",topics:["Wymagania dietetyczne","Alergie","Gotowanie w domu","Fast food"],correct:0,explanation:"M贸wca pyta o opcje wegetariaskie."},{type:"missing-word",sentence:"Chciabym zam贸wi ___.",options:["piwo","ksi偶k","贸偶ko","od藕"],correct:0,explanation:"'Piwo' to popularne zam贸wienie w Polsce."}],[{type:"missing-word",sentence:"Czy mog prosi o ___?",options:["kart da","no偶yczki","w偶a","misk"],correct:0,explanation:"'Kart da' oznacza menu."},{type:"tts",audioText:"Poprosz stek woowy rednio wysma偶ony.",topics:["Zamawianie misa","Proba o napoje","Zam贸wienie deseru","Narzekanie na obsug"],correct:0,explanation:"M贸wca zamawia stek rednio wysma偶ony."},{type:"missing-word",sentence:"Jedzenie byo bardzo ___.",options:["smaczne","wolne","gone","puste"],correct:0,explanation:"'Smaczne' oznacza pyszne."},{type:"tts",audioText:"Czy macie dzisiaj menu lunchowe?",topics:["Pytanie o lunch","Godziny otwarcia","Zam贸wienie na wynos","Rezerwacja stolika"],correct:0,explanation:"M贸wca pyta o menu lunchowe."},{type:"missing-word",sentence:"Jestem ___ i nie jem misa.",options:["wegetarianinem","szalonym","zagubionym","zirytowanym"],correct:0,explanation:"'Wegetarianinem' oznacza osob niejedzc misa."}],[{type:"missing-word",sentence:"Jeszcze jedn ___ kawy, prosz.",options:["fili偶ank","st贸","ciereczk","garnek"],correct:0,explanation:"'Fili偶ank' oznacza ma fili偶ank."},{type:"tts",audioText:"Przystawka bya fantastyczna! Wezm to samo danie g贸wne co wczoraj.",topics:["Chwalenie jedzenia","Narzekanie","Proba o rekomendacje","Rachunek"],correct:0,explanation:"M贸wca chwali przystawk i zamawia to samo danie g贸wne."},{type:"missing-word",sentence:"Rachunek, ___!",options:["prosz","lepiej","tanio","kolorowo"],correct:0,explanation:"'Prosz' to forma grzecznociowa."},{type:"tts",audioText:"Przepraszam, ale w mojej zupie pywa mucha!",topics:["Narzekanie na jedzenie","Zam贸wienie deseru","Proba o wod","Rezerwacja stolika"],correct:0,explanation:"M贸wca narzeka na much w zupie."},{type:"missing-word",sentence:"Chciabym zam贸wi kawaek ___.",options:["ciasta","torebki","drzwi","schod贸w"],correct:0,explanation:"'Ciasta' oznacza tort lub ciasto."}]]},
travel: {name:"Podr贸偶e & Kierunki",icon:"fa-plane",sets:[[{type:"missing-word",sentence:"Gdzie jest najbli偶szy ___?",options:["dworzec","banan","nied藕wied藕","ksi偶ka"],correct:0,explanation:"'Dworzec' oznacza stacj kolejow."},{type:"tts",audioText:"Przepraszam, jak dotrze do muzeum? Czy jest daleko std?",topics:["Pytanie o drog","Kupowanie bilet贸w","Zameldowanie w hotelu","Wynajem samochodu"],correct:0,explanation:"M贸wca pyta o drog do muzeum."},{type:"missing-word",sentence:"Potrzebuj ___ na trzy noce.",options:["pokoju","cukru","gazety","pocigu"],correct:0,explanation:"'Pokoju' oznacza pok贸j hotelowy."},{type:"tts",audioText:"Pocig do Krakowa odje偶d偶a z toru 5. Uwaga, prosz si pospieszy!",topics:["Ogoszenia kolejowe","Informacje lotnicze","Rozkady autobus贸w","Taks贸wki"],correct:0,explanation:"To ogoszenie o odje藕dzie pocigu."},{type:"missing-word",sentence:"Ile kosztuje bilet do ___?",options:["Warszawy","psa","domu","rki"],correct:0,explanation:"'Warszawy' to stolica Polski."}],[{type:"missing-word",sentence:"Czy mo偶esz mi pokaza na ___?",options:["mapie","cign","liczy","paci"],correct:0,explanation:"'Mapie' oznacza map."},{type:"tts",audioText:"Chciabym zarezerwowa prosty pok贸j z prysznicem i niadaniem.",topics:["Rezerwacja hotelu","Wynajem samochodu","Kupowanie pamitek","Informacja turystyczna"],correct:0,explanation:"M贸wca rezerwuje pok贸j z prysznicem i niadaniem."},{type:"missing-word",sentence:"Samolot ___ punktualnie.",options:["startuje","stoi","wznosi si","steruje"],correct:0,explanation:"'Startuje' oznacza odlot samolotu."},{type:"tts",audioText:"Czy jest tu w pobli偶u punkt informacji turystycznej?",topics:["Informacja turystyczna","Restauracje","Transport publiczny","Apteki"],correct:0,explanation:"M贸wca pyta o punkt informacji turystycznej."},{type:"missing-word",sentence:"Zgubiem sw贸j ___.",options:["paszport","parasol","plecak","piercionek"],correct:0,explanation:"'Paszport' to dokument podr贸偶y."}],[{type:"missing-word",sentence:"Jed藕 prosto do nastpnej ___.",options:["sygn邪lizacji","nowej","miej","mokrej"],correct:0,explanation:"'Sygn邪lizacji' oznacza wiata drogowe."},{type:"tts",audioText:"Przepraszam, gdzie mog przechowa baga偶?",topics:["Przechowywanie baga偶u","Toalety","Kantor","Asysta dla niepenosprawnych"],correct:0,explanation:"M贸wca pyta gdzie przechowa baga偶."},{type:"missing-word",sentence:"Chc kupi ___ do Starego Miasta.",options:["bilet","st贸","ciereczk","garnek"],correct:0,explanation:"'Bilet' na transport publiczny."},{type:"tts",audioText:"Autobus odje偶d偶a co 15 minut z dworca g贸wnego.",topics:["Rozkad autobus贸w","Op贸藕nienia pocig贸w","Odwoane loty","Dostpno taks贸wek"],correct:0,explanation:"Opis czstotliwoci autobus贸w."},{type:"missing-word",sentence:"Jak dotrze do najbli偶szego ___?",options:["lotniska","nowego","miego","mokrego"],correct:0,explanation:"'Lotniska' oznacza port lotniczy."}]]},
family: {name:"Rodzina & Przyjaciele",icon:"fa-users",sets:[[{type:"missing-word",sentence:"To jest moja ___.",options:["siostra","szkoa","but","w偶"],correct:0,explanation:"'Siostra' to rodzestwo 偶eskie."},{type:"tts",audioText:"M贸j ojciec pracuje jako lekarz, a moja matka jest nauczycielk.",topics:["Zawody","Hobby","Codzienna rutyna","Czonkowie rodziny"],correct:3,explanation:"M贸wca m贸wi o swoich rodzicach."},{type:"missing-word",sentence:"Masz ___?",options:["rodzestwo","prezenty","gitar","ogr贸d"],correct:0,explanation:"'Rodzestwo' oznacza braci i siostry."},{type:"tts",audioText:"Moi dziadkowie mieszkaj w maej wsi na Mazurach.",topics:["Czonkowie rodziny","Plany podr贸偶y","Mieszkanie","Pogoda"],correct:0,explanation:"M贸wca m贸wi o swoich dziadkach."},{type:"missing-word",sentence:"Jutro obchodzimy urodziny ___.",options:["babci","owoc贸w","piekarnika","ucha"],correct:0,explanation:"'Babci' oznacza urodziny babci."}],[{type:"missing-word",sentence:"M贸j ___ ma na imi ukasz.",options:["brat","list","chleb","ksi偶ka"],correct:0,explanation:"'Brat' to rodzestwo mskie."},{type:"tts",audioText:"Moja kuzynka przyje偶d偶a w przyszym miesicu z Niemiec.",topics:["Wizyty rodzinne","Plany podr贸偶y","Spotkania biznesowe","Wydarzenia szkolne"],correct:0,explanation:"M贸wca m贸wi o wizycie kuzynki."},{type:"missing-word",sentence:"Moi rodzice mieszkaj w ___ domu.",options:["starym","nowym","du偶ym","maym"],correct:1,explanation:"Mo偶na u偶y r贸偶nych przymiotnik贸w."},{type:"tts",audioText:"Mam dwie c贸rki i jednego syna.",topics:["Skad rodziny","Koledzy z pracy","Posiadanie zwierzt","Grupy przyjaci贸"],correct:0,explanation:"M贸wca opisuje swoje dzieci."},{type:"missing-word",sentence:"M贸j ___ jest 偶onaty.",options:["wujek","piekarnik","ucho","miejsce"],correct:0,explanation:"'Wujek' oznacza brata matki lub ojca."}],[{type:"missing-word",sentence:"Moja ___ pracuje w banku.",options:["ciocia","torebka","brama","klatka"],correct:0,explanation:"'Ciocia' to siostra matki lub ojca."},{type:"tts",audioText:"Spotykamy si w ka偶d niedziel na rodzinnej kolacji.",topics:["Tradycje rodzinne","Grafik pracy","Kluby hobby","Zajcia szkolne"],correct:0,explanation:"M贸wca opisuje rodzinn tradycj."},{type:"missing-word",sentence:"M贸j ___ ma pi lat.",options:["siostrzeniec","noc","imi","p贸noc"],correct:0,explanation:"'Siostrzeniec' oznacza syna siostry."},{type:"tts",audioText:"Moi teciowie przyje偶d偶aj jutro w odwiedziny.",topics:["Wizyty teci贸w","Spotkania ze znajomymi","Spotkania biznesowe","Wizyty u lekarza"],correct:0,explanation:"M贸wca wspomina o teciach."},{type:"missing-word",sentence:"Nie mam ju偶 ___.",options:["dziadk贸w","prezent贸w","gitary","ogrodu"],correct:0,explanation:"'Dziadk贸w' oznacza babci i dziadka."}]]},
shopping: {name:"Zakupy",icon:"fa-shopping-bag",sets:[[{type:"missing-word",sentence:"Ile kosztuje ta ___?",options:["kurtka","rok","chopiec","jogurt"],correct:0,explanation:"'Kurtka' oznacza odzie偶 wierzchni."},{type:"tts",audioText:"Czy macie te buty te偶 w rozmiarze 42?",topics:["Pytanie o rozmiar","Zwrot towaru","Pytanie o cen","Godziny otwarcia"],correct:0,explanation:"M贸wca pyta o dostpno rozmiaru."},{type:"missing-word",sentence:"Chciabym te spodnie ___.",options:["wymieni","uczy","rozwa偶a","wiczy"],correct:0,explanation:"'Wymieni' oznacza zwrot towaru."},{type:"tts",audioText:"Kasa znajduje si po lewej stronie sklepu.",topics:["Lokalizacja kasy","Pytanie o zni偶ki","Dostpno produkt贸w","Ukad sklepu"],correct:0,explanation:"Informacja o lokalizacji kasy."},{type:"missing-word",sentence:"Czy jest tu jaka ___?",options:["zni偶ka","deszcz","plecak","restauracja"],correct:0,explanation:"'Zni偶ka' oznacza obni偶k ceny."}],[{type:"missing-word",sentence:"Czy mog zapaci ___?",options:["kart","serem","skrzyni","kul"],correct:0,explanation:"'Kart' patnicz lub kredytow."},{type:"tts",audioText:"Przepraszam, gdzie znajd dzia damski?",topics:["Znajdowanie dzia贸w","Toalety","Wyjcia","Pomoc"],correct:0,explanation:"M贸wca pyta o dzia damski."},{type:"missing-word",sentence:"To jest za ___.",options:["drogo","fajnie","smutno","wiernie"],correct:0,explanation:"'Drogo' oznacza wysok cen."},{type:"tts",audioText:"Czy macie t sukienk te偶 w niebieskim?",topics:["Pytanie o kolory","Sprawdzanie rozmiar贸w","Proba o zni偶ki","Materiay"],correct:0,explanation:"M贸wca pyta o kolor sukienki."},{type:"missing-word",sentence:"Szukam prezentu dla mojej ___.",options:["matki","ksi偶yca","myszy","czapki"],correct:0,explanation:"'Matki' oznacza mam."}],[{type:"missing-word",sentence:"Gdzie jest ___?",options:["przymierzalnia","uniwersytet","zegar","wiczenie"],correct:0,explanation:"'Przymierzalnia' to miejsce do przymierzania ubra."},{type:"tts",audioText:"Czy mo偶e mi pani pom贸c? Szukam czarnego sk贸rzanego paszcza.",topics:["Proba o pomoc","Narzekanie na obsug","Zwroty","Sprawdzanie cen"],correct:0,explanation:"M贸wca prosi o pomoc w znalezieniu paszcza."},{type:"missing-word",sentence:"Wezm ___ kolor.",options:["inny","stary","biedny","wszystkie"],correct:0,explanation:"'Inny' oznacza odmienny kolor."},{type:"tts",audioText:"Godziny otwarcia s od 9 do 20.",topics:["Godziny otwarcia","Okresy wyprzeda偶y","Czas dostawy","Polityka zwrot贸w"],correct:0,explanation:"Informacja o godzinach otwarcia."},{type:"missing-word",sentence:"Czy mog dosta ___?",options:["paragon","meduza","藕r贸do","twar贸g"],correct:0,explanation:"'Paragon' to dow贸d zakupu."}]]},
hobbies: {name:"Hobby & Wolny czas",icon:"fa-film",sets:[[{type:"missing-word",sentence:"Lubi gra na ___.",options:["pianinie","serze","skrzyni","kuli"],correct:0,explanation:"'Pianinie' to instrument muzyczny."},{type:"tts",audioText:"W sobot id do kina obejrze nowy film Marvela.",topics:["Kino","Czytanie ksi偶ek","Sport","Gotowanie"],correct:0,explanation:"M贸wca idzie do kina."},{type:"missing-word",sentence:"Moje hobby to ___.",options:["fotografia","okno","ryba","pi贸ro"],correct:0,explanation:"'Fotografia' to hobby."},{type:"tts",audioText:"Codziennie wieczorem przed snem czytam ksi偶k.",topics:["Czytanie","Pisanie","Malowanie","Taniec"],correct:0,explanation:"M贸wca czyta ksi偶k przed snem."},{type:"missing-word",sentence:"W weekend czsto chodz ___.",options:["na spacery","czeka","my","偶yczy"],correct:0,explanation:"'Na spacery' to popularne hobby."}],[{type:"missing-word",sentence:"Gram w pik no偶n w ___.",options:["klubie","ruchu","rozumie","umowie"],correct:0,explanation:"'Klubie' sportowym."},{type:"tts",audioText:"M贸j ulubiony zesp贸 gra dzi wieczorem w parku.",topics:["Koncerty","Ogldanie sportu","Muzea","Restauracje"],correct:0,explanation:"M贸wca m贸wi o koncercie."},{type:"missing-word",sentence:"Lubi chodzi ___.",options:["pywa","pisa","zamyka","ci"],correct:0,explanation:"'Pywa' to sport."},{type:"tts",audioText:"W niedziel zawsze piek ciasto dla mojej rodziny.",topics:["Pieczenie","Ogrodnictwo","Malowanie","Gry komputerowe"],correct:0,explanation:"M贸wca piecze ciasto w niedziel."},{type:"missing-word",sentence:"Zbieram stare ___.",options:["monety","czapki","myszy","meble"],correct:0,explanation:"'Monety' to popularny przedmiot kolekcjonerski."}],[{type:"missing-word",sentence:"Lubi fotografowa ___.",options:["krajobrazy","y偶k","lokal","piosenki"],correct:0,explanation:"'Krajobrazy' to popularny temat fotografii."},{type:"tts",audioText:"W ka偶dy czwartek chodz na tace do domu kultury.",topics:["Taniec","Pywanie","Czytanie","Gotowanie"],correct:0,explanation:"M贸wca chodzi na tace."},{type:"missing-word",sentence:"Gram na ___ gitarze.",options:["","","",""],correct:0,explanation:"Poprawny rodzajnik dla 'gitara'."},{type:"tts",audioText:"W wolnym czasie maluj akwarele.",topics:["Malowanie","piewanie","Bieganie","Zakupy"],correct:0,explanation:"M贸wca maluje akwarele."},{type:"missing-word",sentence:"Lubi sucha ___ muzyki.",options:["klasycznej","zimnej","zepsutej","kr贸tkiej"],correct:0,explanation:"'Klasycznej' muzyki."}]]},
animals: {name:"Zwierzta & Przyroda",icon:"fa-paw",sets:[[{type:"missing-word",sentence:"___ szczeka gono.",options:["Pies","Kapelusz","Dom","Rka"],correct:0,explanation:"'Pies' to zwierz domowe."},{type:"tts",audioText:"W lesie jest wiele zwierzt takich jak sarny, lisy i wiewi贸rki.",topics:["呕ycie w miecie","Zwierzta lene","Zwierzta morskie","Zwierzta gospodarskie"],correct:1,explanation:"Zdanie opisuje zwierzta lene."},{type:"missing-word",sentence:"___ lata wysoko na niebie.",options:["Ptak","Waza","Sdzia","Peny"],correct:0,explanation:"'Ptak' lata."},{type:"tts",audioText:"Wiosn kwitn kwiaty, a drzewa wypuszczaj nowe licie.",topics:["Pory roku","Pogoda","Ogrodnictwo","Cykl przyrody"],correct:3,explanation:"Opis cyklu przyrody wiosn."},{type:"missing-word",sentence:"Widz ___ w zoo.",options:["lwa","y偶k","lokal","piosenk"],correct:0,explanation:"'Lwa' w zoo."}],[{type:"missing-word",sentence:"___ robi muuu.",options:["Krowa","Kot","Skrzynia","Kula"],correct:0,explanation:"'Krowa' to zwierz gospodarskie."},{type:"tts",audioText:"Na pla偶y czsto mo偶na zobaczy mewy i kraby.",topics:["Zwierzta pla偶owe","Zwierzta lene","Zwierzta g贸rskie","Zwierzta pustynne"],correct:0,explanation:"Opis zwierzt na pla偶y."},{type:"missing-word",sentence:"___ wspina si na drzewa.",options:["Mapa","Jabko","Rami","Oko"],correct:0,explanation:"'Mapa' wspina si."},{type:"tts",audioText:"Jesieni licie spadaj z drzew, a dni staj si kr贸tsze.",topics:["Zmiany jesienne","Przygotowania do zimy","Wiosna","Letnie aktywnoci"],correct:0,explanation:"Opis zmian jesiennych."},{type:"missing-word",sentence:"___ bzyczy wok贸 kwiat贸w.",options:["Pszczoa","Banan","Nied藕wied藕","Ksi偶ka"],correct:0,explanation:"'Pszczoa' bzyczy."}],[{type:"missing-word",sentence:"___ ryczy gono.",options:["Tygrys","St贸","ciereczka","Garnek"],correct:0,explanation:"'Tygrys' ryczy."},{type:"tts",audioText:"Zim wiele ptak贸w odlatuje do cieplejszych kraj贸w.",topics:["Migracja ptak贸w","Hibernacja","Roliny","Prdy oceaniczne"],correct:0,explanation:"Opis migracji ptak贸w."},{type:"missing-word",sentence:"___ ma dugie uszy.",options:["Zajce","Spodnie","Dom","Rka"],correct:0,explanation:"'Zajce' maj dugie uszy."},{type:"tts",audioText:"Wiosn wykluwaj si pisklta z jaj.",topics:["Wiosenne wykluwanie","Letnie rozmna偶anie","Jesienne zbiory","Zimowy sen"],correct:0,explanation:"Opis wykluwania si pisklt."},{type:"missing-word",sentence:"___ 偶yje w d偶ungli.",options:["Papuga","Papier","Ko","Rolina"],correct:0,explanation:"'Papuga' 偶yje w d偶ungli."}]]},
work: {name:"Praca & Biuro",icon:"fa-briefcase",sets:[[{type:"missing-word",sentence:"Mam ___ z moim szefem.",options:["spotkanie","n贸偶","paszcz","ksi偶yc"],correct:0,explanation:"'Spotkanie' w kontekcie biznesowym."},{type:"tts",audioText:"Czy m贸gby mi pan wysa prezentacj mailem?",topics:["Proby","Narzekanie","Socjalizacja","Wydawanie polece"],correct:0,explanation:"M贸wca prosi o przesanie prezentacji."},{type:"missing-word",sentence:"M贸j ___ jest dzi bardzo zajty.",options:["kolega","ciasto","walizka","kino"],correct:0,explanation:"'Kolega' z pracy."},{type:"tts",audioText:"Firma szuka nowych pracownik贸w do dziau marketingu.",topics:["Szukanie pracy","Nowoci w firmie","Plotki biurowe","Narzekanie na prac"],correct:0,explanation:"Informacja o rekrutacji."},{type:"missing-word",sentence:"Musz napisa ___.",options:["raport","pik","贸偶ko","od藕"],correct:0,explanation:"'Raport' biznesowy."}],[{type:"missing-word",sentence:"Pracuj jako ___.",options:["in偶ynier","je偶","wyspa","pomys"],correct:0,explanation:"'In偶ynier' to zaw贸d."},{type:"tts",audioText:"Czy m贸gby pan to powt贸rzy? Nie zrozumiaem.",topics:["Proba o wyjanienie","Narzekanie","Instrukcje","Wieci osobiste"],correct:0,explanation:"M贸wca prosi o powt贸rzenie."},{type:"missing-word",sentence:"___ zaczyna si o 9:00.",options:["Praca","Lekarz","Rami","Oko"],correct:0,explanation:"'Praca' si zaczyna."},{type:"tts",audioText:"Musz zrobi nadgodziny, bo projekt musi by gotowy na jutro.",topics:["Nadgodziny","Urlop","Zwalnianie si","Podwy偶ka"],correct:0,explanation:"M贸wca o nadgodzinach."},{type:"missing-word",sentence:"Potrzebuj nowego ___.",options:["komputera","kuzyna","kremu","wiolonczeli"],correct:0,explanation:"'Komputera' do pracy."}],[{type:"missing-word",sentence:"M贸j ___ jest chory.",options:["szef","ch贸r","chipsy","chemia"],correct:0,explanation:"'Szef' jest chory."},{type:"tts",audioText:"Czy m贸gby mi pan pom贸c? Nie rozumiem tej tabeli w Excelu.",topics:["Proba o pomoc","Narzekanie na oprogramowanie","Szkolenia","Zgaszanie bd贸w"],correct:0,explanation:"M贸wca prosi o pomoc z Excelem."},{type:"missing-word",sentence:"Mam dzi ___ wolne.",options:["urlop","zegar","uniwersytet","wiczenie"],correct:0,explanation:"'Urlop' wolny."},{type:"tts",audioText:"Konferencja odbdzie si w przyszym tygodniu w siedzibie g贸wnej.",topics:["Ogoszenia konferencji","Spotkania zespou","Wizyty klient贸w","Szkolenia"],correct:0,explanation:"Ogoszenie o konferencji."},{type:"missing-word",sentence:"Musz wysa ___.",options:["e-mail","osa","truskawk","kt"],correct:0,explanation:"'E-mail' w pracy."}]]},
health: {name:"Zdrowie & Ciao",icon:"fa-heartbeat",sets:[[{type:"missing-word",sentence:"Boli mnie ___.",options:["gowa","kosz","kucharz","kapusta"],correct:0,explanation:"'Gowa' boli."},{type:"tts",audioText:"Nie czuj si dobrze. Mam gorczk i b贸l garda.",topics:["Opisywanie objaw贸w","Plany","Jedzenie","Pogoda"],correct:0,explanation:"M贸wca opisuje objawy choroby."},{type:"missing-word",sentence:"Prosz bra ___ tabletki trzy razy dziennie.",options:["te","ten","to","tego"],correct:0,explanation:"Poprawny zaimek dla 'tabletki'."},{type:"tts",audioText:"Sport jest dobry dla zdrowia. Biegam codziennie.",topics:["Korzyci wicze","Dieta","Zabiegi medyczne","Sen"],correct:0,explanation:"M贸wca o korzyciach sportu."},{type:"missing-word",sentence:"Id do ___.",options:["lekarza","samochodu","jabka","oka"],correct:0,explanation:"'Lekarza' wizyta."}],[{type:"missing-word",sentence:"Mam silny ___ b贸l.",options:["brzucha","ksi偶ki","贸偶ka","odzi"],correct:0,explanation:"'Brzucha' b贸l."},{type:"tts",audioText:"Potrzebuj recepty na antybiotyk.",topics:["Proba o leki","Wyniki bada","Umawianie wizyt","Dieta"],correct:0,explanation:"M贸wca potrzebuje recepty."},{type:"missing-word",sentence:"Moje ___ koacze.",options:["serce","koszula","pies","dom"],correct:0,explanation:"'Serce' koacze."},{type:"tts",audioText:"Powinienem pi wicej wody, a mniej kawy.",topics:["Nawodnienie","Sen","wiczenia","Leki"],correct:0,explanation:"M贸wca o nawodnieniu."},{type:"missing-word",sentence:"Mam ___ wizyt.",options:["lekarsk","samochodow","jabkow","oczn"],correct:0,explanation:"'Lekarsk' wizyt."}],[{type:"missing-word",sentence:"Swdzi mnie ___.",options:["rami","jabko","samoch贸d","oko"],correct:0,explanation:"'Rami' swdzi."},{type:"tts",audioText:"Musz bra leki o 8 rano.",topics:["Harmonogram lek贸w","Dieta","wiczenia","Sen"],correct:0,explanation:"M贸wca o harmonogramie lek贸w."},{type:"missing-word",sentence:"Czuj si ___.",options:["zmczony","agodny","chudy","rzeki"],correct:0,explanation:"'Zmczony' to uczucie."},{type:"tts",audioText:"Mam od dw贸ch dni biegunk i wymioty.",topics:["Powa偶ne objawy","Drobne dolegliwoci","Alergie","Sen"],correct:0,explanation:"M贸wca opisuje powa偶ne objawy."},{type:"missing-word",sentence:"Potrzebuj ___ odpoczynku.",options:["wicej","m贸j","najczciej","porodku"],correct:0,explanation:"'Wicej' odpoczynku."}]]},
school: {name:"Szkoa & Edukacja",icon:"fa-graduation-cap",sets:[[{type:"missing-word",sentence:"___ zaczyna si o 8:00.",options:["Szkoa","But","W偶","Miska"],correct:0,explanation:"'Szkoa' si zaczyna."},{type:"tts",audioText:"Na egzamin musimy si nauczy rozdzia贸w 1 do 5.",topics:["Przygotowanie do egzaminu","Narzekanie na zadanie","Chwalenie nauczyciela","Zasady w klasie"],correct:0,explanation:"M贸wca o przygotowaniu do egzaminu."},{type:"missing-word",sentence:"Dostaem dobr ___ z matematyki.",options:["ocen","nos","noc","numer"],correct:0,explanation:"'Ocen' w szkole."},{type:"tts",audioText:"Na przerwie gramy w pik na boisku szkolnym.",topics:["Zajcia na przerwie","Lekcje","Praca domowa","K贸ka pozalekcyjne"],correct:0,explanation:"Opis zaj na przerwie."},{type:"missing-word",sentence:"M贸j ___ pomaga mi w zadaniach.",options:["nauczyciel","y偶ka","lokal","piosenka"],correct:0,explanation:"'Nauczyciel' pomaga."}],[{type:"missing-word",sentence:"Chodz do ___ klasy.",options:["贸smej","starej","biednej","wszystkich"],correct:0,explanation:"'smej' klasy."},{type:"tts",audioText:"Zadanie domowe na jutro jest na stronie 45, zadanie 3.",topics:["Zadania domowe","Ogoszenia test贸w","Wycieczki","Godziny k贸ek"],correct:0,explanation:"Informacja o zadaniu domowym."},{type:"missing-word",sentence:"Mamy dzi ___ lekcj.",options:["muzyki","matki","usty","myszy"],correct:0,explanation:"'Muzyki' lekcja."},{type:"tts",audioText:"Sprawdzian z historii by bardzo trudny.",topics:["Trudno testu","Obci偶enie prac domow","Zachowanie nauczyciela","Atmosfera w klasie"],correct:0,explanation:"Komentarz o trudnym sprawdzianie."},{type:"missing-word",sentence:"Potrzebuj nowego ___ zeszytu.",options:["matematycznego","matczynego","ustnego","mysiego"],correct:0,explanation:"'Matematycznego' zeszytu."}],[{type:"missing-word",sentence:"___ dzwoni o 12:00.",options:["Przerwa","Lalka","Patelnia","Rolina"],correct:0,explanation:"'Przerwa' w szkole."},{type:"tts",audioText:"Nasz nauczyciel fizyki zawsze bardzo przejrzycie tumaczy eksperymenty.",topics:["Chwalenie nauczyciela","Narzekanie na przedmiot","Problemy z zadaniami","Zasady w klasie"],correct:0,explanation:"Chwalenie nauczyciela fizyki."},{type:"missing-word",sentence:"Ucz si na ___ egzamin.",options:["kocowy","jabko","samoch贸d","oko"],correct:0,explanation:"'Kocowy' egzamin."},{type:"tts",audioText:"W bibliotece trzeba by cicho.",topics:["Zasady biblioteki","Zachowanie w klasie","Etykieta w sto贸wce","Bezpieczestwo na placu zabaw"],correct:0,explanation:"Zasada w bibliotece."},{type:"missing-word",sentence:"M贸j ___ przedmiot to biologia.",options:["ulubiony","dugi","gony","pusty"],correct:0,explanation:"'Ulubiony' przedmiot."}]]},
cities: {name:"Miasta & Miejsca",icon:"fa-city",sets:[[{type:"missing-word",sentence:"Warszawa jest ___ Polski.",options:["stolic","dworcem","g贸wn ulic","bram"],correct:0,explanation:"'Stolic' kraju."},{type:"tts",audioText:"W Krakowie jest synny Wawel i pikny rynek.",topics:["Atrakcje miejskie","Por贸wnania kraj贸w","呕ycie wiejskie","Systemy transportowe"],correct:0,explanation:"Opis atrakcji Krakowa."},{type:"missing-word",sentence:"___ jest bardzo stare i historyczne.",options:["Zamek","But","W偶","Miska"],correct:0,explanation:"'Zamek' historyczny."},{type:"tts",audioText:"Stare Miasto w Gdasku jest znane z piknej architektury.",topics:["Dzielnice historyczne","Architektura nowoczesna","Obszary przemysowe","呕ycie podmiejskie"],correct:0,explanation:"Opis Starego Miasta w Gdasku."},{type:"missing-word",sentence:"Odwiedzam ___ w weekend.",options:["muzeum","ksi偶yc","mysz","czapk"],correct:0,explanation:"'Muzeum' wizyta."}],[{type:"missing-word",sentence:"Gdask ma du偶y ___ port.",options:["morski","but","w偶","miska"],correct:0,explanation:"'Morski' port."},{type:"tts",audioText:"We Wrocawiu jest wiele krasnali i pikny rynek.",topics:["Atrakcje miasta","Miejsca historyczne","Krajobrazy naturalne","Wsie"],correct:0,explanation:"Opis atrakcji Wrocawia."},{type:"missing-word",sentence:"W Poznaniu s synne ___ kozioki.",options:["poznaskie","zimne","mae","krzywe"],correct:0,explanation:"'Poznaskie' kozioki."},{type:"tts",audioText:"Zakopane jest nazywane zimow stolic Polski.",topics:["Przydomki miast","Miasta przemysowe","Miasteczka g贸rskie","Kurorty nadmorskie"],correct:0,explanation:"Przydomek Zakopanego."},{type:"missing-word",sentence:"W ___ jest synna panorama racawicka.",options:["Wrocawiu","Wsi","Dachu","Suficie"],correct:0,explanation:"Panorama racawicka we Wrocawiu."}],[{type:"missing-word",sentence:"___ to najdu偶sza ulica w Warszawie.",options:["Marszakowska","Podkoszulek","Podkadka","Zakwaterowanie"],correct:0,explanation:"'Marszakowska' w Warszawie."},{type:"tts",audioText:"Mazury to popularny region turystyczny na p贸nocnym wschodzie Polski.",topics:["Regiony turystyczne","Centra miejskie","Strefy przemysowe","Obszary nadmorskie"],correct:0,explanation:"Opis Mazur."},{type:"missing-word",sentence:"___ jest najwikszym jeziorem w Polsce.",options:["niardwy","Podoga","贸d藕","Ksi偶ka"],correct:0,explanation:"'niardwy' to najwiksze jezioro."},{type:"tts",audioText:"Rysy to najwy偶szy szczyt Polski i znajduje si w Tatrach.",topics:["G贸ry","Rzeki","Lasy","Pustynie"],correct:0,explanation:"Opis najwy偶szego szczytu."},{type:"missing-word",sentence:"Wisa to wa偶na ___ w Europie.",options:["rzeka","ryba","skaa","pole"],correct:0,explanation:"'Rzeka' Wisa."}]]}
};

// Track last used sets per topic to ensure variety
let topicSetHistory = JSON.parse(localStorage.getItem('terazPolskiSetHistory')) || {};

// Shuffle array helper function
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Randomize correct answer position
function randomizeOptions(options, correctIndex) {
    const correctAnswer = options[correctIndex];
    const incorrectAnswers = options.filter((_, i) => i !== correctIndex);
    const shuffledIncorrect = shuffleArray(incorrectAnswers);
    
    const correctPos = Math.floor(Math.random() * options.length);
    const newOptions = [];
    let incorrectIndex = 0;
    
    for (let i = 0; i < options.length; i++) {
        if (i === correctPos) {
            newOptions.push(correctAnswer);
        } else {
            newOptions.push(shuffledIncorrect[incorrectIndex++]);
        }
    }
    
    return { 
        options: newOptions, 
        correctIndex: newOptions.indexOf(correctAnswer) 
    };
}

// Select a random set that hasn't been used recently
function selectRandomSet(topicKey) {
    const sets = allTopics[topicKey].sets;
    const numSets = sets.length;
    
    // Initialize history if needed
    if (!topicSetHistory[topicKey]) {
        topicSetHistory[topicKey] = [];
    }
    
    // Get available sets (not in last 2 used)
    const availableSets = [];
    for (let i = 0; i < numSets; i++) {
        if (!topicSetHistory[topicKey].slice(-2).includes(i)) {
            availableSets.push(i);
        }
    }
    
    // If all sets were recently used, reset history
    if (availableSets.length === 0) {
        topicSetHistory[topicKey] = [];
        for (let i = 0; i < numSets; i++) {
            availableSets.push(i);
        }
    }
    
    // Select random from available
    const randomIndex = availableSets[Math.floor(Math.random() * availableSets.length)];
    
    // Update history
    topicSetHistory[topicKey].push(randomIndex);
    localStorage.setItem('terazPolskiSetHistory', JSON.stringify(topicSetHistory));
    
    return randomIndex;
}

// Scroll to next button smoothly
function scrollToNextButton() {
  setTimeout(() => {
    const nextBtn = document.querySelector('.btn-next');
    if (nextBtn) {
      nextBtn.scrollIntoView({
        behavior: 'smooth',
        block: 'center',
        inline: 'nearest'
      });
      setTimeout(() => nextBtn.focus(), 300);
    }
  }, 150);
}

// App state
let currentTopic = null;
let currentExercise = 0;
let points = 0;
let userAnswers = [];
let speechSynthesis = window.speechSynthesis;
let isDarkMode = localStorage.getItem('darkMode') === 'true';
let topicBestScores = JSON.parse(localStorage.getItem('terazPolskiBestScores')) || {};
let currentSetIndex = null;

// DOM elements
const exerciseContainer = document.getElementById('exercise-container');
const progressContainer = document.getElementById('progress-container');
const progressFill = document.getElementById('progress-fill');
const progressText = document.getElementById('progress-text');
const pointsDisplay = document.getElementById('points');
const completionScreen = document.getElementById('completion-screen');
const finalScore = document.getElementById('final-score');
const completionMessage = document.getElementById('completion-message');
const topicSelectionScreen = document.getElementById('topic-selection-screen');
const topicOptionsContainer = document.getElementById('topic-options-container');
const themeToggle = document.getElementById('theme-toggle');
const newTopicBtn = document.getElementById('new-topic-btn');
const restartTopicBtn = document.getElementById('restart-topic-btn');

// Set initial theme
applyTheme();

// Toggle dark mode
themeToggle.addEventListener('click', () => {
    isDarkMode = !isDarkMode;
    localStorage.setItem('darkMode', isDarkMode);
    applyTheme();
    
    const icon = themeToggle.querySelector('i');
    icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
});

function applyTheme() {
    const root = document.documentElement;
    if (isDarkMode) {
        root.style.setProperty('--bg', 'var(--dark-bg)');
        root.style.setProperty('--text', 'var(--text-dark)');
        root.style.setProperty('--card', 'var(--card-dark)');
        root.style.setProperty('--border', 'var(--border-dark)');
        root.style.setProperty('--option-bg', 'var(--option-bg-dark)');
        root.style.setProperty('--bg-sentence', 'rgba(30, 41, 59, 0.7)');
        root.style.setProperty('--shadow', 'var(--shadow-dark)');
        root.style.setProperty('--feedback-correct', 'var(--feedback-correct-dark)');
        root.style.setProperty('--feedback-correct-text', 'white');
        root.style.setProperty('--feedback-incorrect', 'var(--feedback-incorrect-dark)');
        root.style.setProperty('--feedback-incorrect-text', 'white');
        root.style.setProperty('--warning', '#fbbf24');
    } else {
        root.style.setProperty('--bg', 'var(--light-bg)');
        root.style.setProperty('--text', 'var(--text-light)');
        root.style.setProperty('--card', 'var(--card-light)');
        root.style.setProperty('--border', 'var(--border-light)');
        root.style.setProperty('--option-bg', 'var(--option-bg-light)');
        root.style.setProperty('--bg-sentence', '#f1f5ff');
        root.style.setProperty('--shadow', 'var(--shadow-light)');
        root.style.setProperty('--feedback-correct', 'var(--feedback-correct-light)');
        root.style.setProperty('--feedback-correct-text', 'var(--text-light)');
        root.style.setProperty('--feedback-incorrect', 'var(--feedback-incorrect-light)');
        root.style.setProperty('--feedback-incorrect-text', 'var(--text-light)');
        root.style.setProperty('--warning', '#f8961e');
    }
}

// Initialize the app
function initApp() {
    renderTopicSelection();
    
    newTopicBtn.addEventListener('click', showTopicSelection);
    restartTopicBtn.addEventListener('click', () => startTopicExercises(currentTopic));
}

// Render topic selection screen
function renderTopicSelection() {
    topicOptionsContainer.innerHTML = '';
    
    Object.keys(allTopics).forEach(topicKey => {
        const topic = allTopics[topicKey];
        const bestScore = topicBestScores[topicKey] || 0;
        
        const topicOption = document.createElement('div');
        topicOption.className = 'topic-option';
        topicOption.dataset.topic = topicKey;
        topicOption.innerHTML = `
            <i class="fas ${topic.icon}"></i>
            ${topic.name}
            ${bestScore > 0 ? `<div class="score-badge">${Math.round(bestScore)}</div>` : ''}
        `;
        
        topicOption.addEventListener('click', () => startTopicExercises(topicKey));
        topicOptionsContainer.appendChild(topicOption);
    });
}

// Start topic exercises
function startTopicExercises(topicKey) {
    topicSelectionScreen.classList.add('hidden');
    progressContainer.classList.remove('hidden');
    exerciseContainer.classList.remove('hidden');
    completionScreen.classList.add('hidden');
    
    currentTopic = topicKey;
    currentExercise = 0;
    points = 0;
    
    // GUARANTEED NEW SET EVERY TIME
    currentSetIndex = selectRandomSet(topicKey);
    const exercises = allTopics[topicKey].sets[currentSetIndex];
    userAnswers = new Array(exercises.length).fill(null);
    
    pointsDisplay.textContent = points;
    updateProgress();
    loadExercise(currentExercise);
}

// Load and display current exercise
function loadExercise(index) {
    const topicData = allTopics[currentTopic];
    const exercises = topicData.sets[currentSetIndex];
    const exercise = exercises[index];
    exerciseContainer.innerHTML = '';
    
    const titleContainer = document.createElement('div');
    titleContainer.className = 'exercise-title';
    titleContainer.innerHTML = `
        <span><i class="fas fa-${exercise.type === 'missing-word' ? 'puzzle-piece' : 'headphones'}"></i> ${exercise.type === 'missing-word' ? 'Uzupenij luki' : 'Posuchaj i wybierz temat'}</span>
        <div>
            <span class="topic-name">${topicData.name}</span>
            <button class="back-btn" id="back-to-topics-btn">
                <i class="fas fa-arrow-left"></i> Tematy
            </button>
        </div>
    `;
    exerciseContainer.appendChild(titleContainer);
    
    setTimeout(() => {
        const backBtn = document.getElementById('back-to-topics-btn');
        if (backBtn) {
            backBtn.addEventListener('click', showTopicSelection);
        }
    }, 0);
    
    if (exercise.type === 'missing-word') {
        const randomized = randomizeOptions(exercise.options, exercise.correct);
        exercise.currentOptions = randomized.options;
        exercise.currentCorrect = randomized.correctIndex;
    }
    
    if (exercise.type === 'tts') {
        const topics = [...exercise.topics];
        const correctTopic = topics[exercise.correct];
        const shuffledTopics = shuffleArray(topics);
        const newCorrectIndex = shuffledTopics.indexOf(correctTopic);
        
        exercise.currentTopics = shuffledTopics;
        exercise.currentCorrect = newCorrectIndex;
    }
    
    if (exercise.type === 'missing-word') {
        renderMissingWordExercise(exercise, exercises);
    } else if (exercise.type === 'tts') {
        renderTTsExercise(exercise);
    }
}

// Render missing word exercise
function renderMissingWordExercise(exercise, exercises) {
    const content = document.createElement('div');
    content.className = 'exercise-content missing-word-exercise';
    
    const sentence = document.createElement('div');
    sentence.className = 'sentence';
    sentence.textContent = exercise.sentence;
    content.appendChild(sentence);
    
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'options-container';
    
    const options = exercise.currentOptions;
    const correctIndex = exercise.currentCorrect;
    
    options.forEach((option, index) => {
        const optionBtn = document.createElement('button');
        optionBtn.className = 'option-btn';
        optionBtn.textContent = option;
        optionBtn.dataset.index = index;
        
        if (userAnswers[currentExercise] !== undefined && userAnswers[currentExercise] !== null) {
            optionBtn.disabled = true;
            if (index === userAnswers[currentExercise]) {
                optionBtn.classList.add('selected');
                if (index === correctIndex) {
                    optionBtn.classList.add('correct');
                } else {
                    optionBtn.classList.add('incorrect');
                }
            } else if (index === correctIndex) {
                optionBtn.classList.add('correct');
            }
        }
        
        optionBtn.addEventListener('click', () => handleMissingWordAnswer(index, correctIndex, exercise, exercises));
        optionsContainer.appendChild(optionBtn);
    });
    
    content.appendChild(optionsContainer);
    
    const feedback = document.createElement('div');
    feedback.className = 'feedback';
    feedback.id = 'feedback';
    content.appendChild(feedback);
    
    exerciseContainer.appendChild(content);
    addNavigation();
}

// Handle missing word answer
function handleMissingWordAnswer(selectedIndex, correctIndex, exercise, exercises) {
    userAnswers[currentExercise] = selectedIndex;
    
    if (selectedIndex === correctIndex) {
        points += 10;
        pointsDisplay.textContent = points;
    }
    
    const buttons = document.querySelectorAll('.option-btn');
    buttons.forEach((btn, index) => {
        btn.disabled = true;
        if (index === selectedIndex) {
            btn.classList.add('selected');
            if (index === correctIndex) {
                btn.classList.add('correct');
            } else {
                btn.classList.add('incorrect');
            }
        } else if (index === correctIndex) {
            btn.classList.add('correct');
        }
    });
    
    const feedback = document.getElementById('feedback');
    if (selectedIndex === correctIndex) {
        feedback.textContent = `Poprawnie! ${exercise.explanation}`;
        feedback.className = 'feedback correct';
        const fullCorrectSentence = exercise.sentence.replace("___", exercise.options[exercise.correct]);
        setTimeout(() => speakText(fullCorrectSentence), 500);
    } else {
        feedback.textContent = `Niepoprawnie. ${exercise.explanation}`;
        feedback.className = 'feedback incorrect';
        const fullCorrectSentence = exercise.sentence.replace("___", exercise.options[exercise.correct]);
        setTimeout(() => speakText(fullCorrectSentence), 1000);
    }
    
    document.querySelector('.btn-next').disabled = false;
    
    // SCROLL TO NEXT BUTTON
    scrollToNextButton();
}

// Render TTS exercise
function renderTTsExercise(exercise) {
    const content = document.createElement('div');
    content.className = 'exercise-content tts-exercise';
    
    const instruction = document.createElement('p');
    instruction.textContent = 'Posuchaj zdania po polsku i wybierz poprawny temat:';
    instruction.style.marginBottom = '20px';
    instruction.style.fontSize = '1.1rem';
    content.appendChild(instruction);
    
    const audioControls = document.createElement('div');
    audioControls.className = 'audio-controls';
    
    const playBtn = document.createElement('button');
    playBtn.className = 'play-btn';
    playBtn.innerHTML = '<i class="fas fa-play"></i>';
    playBtn.title = 'Odtw贸rz audio';
    
    playBtn.addEventListener('click', () => {
        speakText(exercise.audioText);
        playBtn.disabled = true;
        setTimeout(() => {
            playBtn.disabled = false;
        }, 5000);
    });
    
    audioControls.appendChild(playBtn);
    content.appendChild(audioControls);
    
    const topicsContainer = document.createElement('div');
    topicsContainer.className = 'topics-container';
    
    const topics = exercise.currentTopics;
    const correctIndex = exercise.currentCorrect;
    
    topics.forEach((topic, index) => {
        const topicCard = document.createElement('div');
        topicCard.className = 'topic-card';
        topicCard.textContent = topic;
        topicCard.dataset.index = index;
        
        if (userAnswers[currentExercise] !== undefined && userAnswers[currentExercise] !== null) {
            topicCard.classList.add('locked');
            if (index === userAnswers[currentExercise]) {
                topicCard.classList.add('selected');
            }
            if (userAnswers[currentExercise] !== correctIndex && index === correctIndex) {
                topicCard.classList.add('correct');
            }
        }
        
        topicCard.addEventListener('click', () => handleTTSAnswer(index, correctIndex, exercise));
        topicsContainer.appendChild(topicCard);
    });
    
    content.appendChild(topicsContainer);
    
    const feedback = document.createElement('div');
    feedback.className = 'feedback';
    feedback.id = 'feedback';
    content.appendChild(feedback);
    
    exerciseContainer.appendChild(content);
    addNavigation();
}

// Handle TTS answer
function handleTTSAnswer(selectedIndex, correctIndex, exercise) {
    userAnswers[currentExercise] = selectedIndex;
    
    if (selectedIndex === correctIndex) {
        points += 10;
        pointsDisplay.textContent = points;
    }
    
    const cards = document.querySelectorAll('.topic-card');
    cards.forEach((card, index) => {
        card.classList.add('locked');
        if (index === selectedIndex) {
            card.classList.add('selected');
        }
        if (index === correctIndex) {
            card.classList.add('correct');
        }
    });
    
    const feedback = document.getElementById('feedback');
    if (selectedIndex === correctIndex) {
        feedback.textContent = `Poprawnie! ${exercise.explanation}`;
        feedback.className = 'feedback correct';
    } else {
        feedback.textContent = `Niepoprawnie. ${exercise.explanation}`;
        feedback.className = 'feedback incorrect';
    }
    
    document.querySelector('.btn-next').disabled = false;
    
    // SCROLL TO NEXT BUTTON
    scrollToNextButton();
}

// Text-to-speech function
function speakText(text) {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'pl-PL';
    utterance.rate = 0.9;
    utterance.pitch = 1;
    speechSynthesis.speak(utterance);
}

// Add navigation buttons
function addNavigation() {
    const nav = document.createElement('div');
    nav.className = 'navigation';
    
    const prevBtn = document.createElement('button');
    prevBtn.className = 'btn btn-prev';
    prevBtn.textContent = 'Poprzednie';
    prevBtn.disabled = currentExercise === 0;
    prevBtn.addEventListener('click', () => {
        if (currentExercise > 0) {
            currentExercise--;
            loadExercise(currentExercise);
            updateProgress();
        }
    });
    
    const nextBtn = document.createElement('button');
    nextBtn.className = 'btn btn-next';
    nextBtn.textContent = currentExercise === 4 ? 'Zakocz temat' : 'Nastpne';
    nextBtn.disabled = userAnswers[currentExercise] === undefined || userAnswers[currentExercise] === null;
    nextBtn.addEventListener('click', () => {
        if (currentExercise < 4) {
            currentExercise++;
            loadExercise(currentExercise);
            updateProgress();
        } else {
            finishTopic();
        }
    });
    
    nav.appendChild(prevBtn);
    nav.appendChild(nextBtn);
    exerciseContainer.appendChild(nav);
}

// Update progress bar and text
function updateProgress() {
    const totalExercises = 5;
    const progress = ((currentExercise + 1) / totalExercises) * 100;
    progressFill.style.width = `${progress}%`;
    progressText.textContent = `${currentExercise + 1}/${totalExercises}`;
}

// Finish topic and save score
function finishTopic() {
  if (points > (topicBestScores[currentTopic] || 0)) {
    topicBestScores[currentTopic] = points;
    localStorage.setItem('terazPolskiBestScores', JSON.stringify(topicBestScores));
  }

  let message = "wicz dalej! ";
  let color = "#f8961e";
  if (points >= 45) {
    message = "Wybitnie! ";
    color = "#4ade80";
  } else if (points >= 35) {
    message = "wietna robota! ";
    color = "#4cc9f0";
  } else if (points >= 25) {
    message = "Dobry wysiek! ";
    color = "#f8961e";
  }

  completionMessage.textContent = message;
  completionMessage.style.color = color;

  exerciseContainer.classList.add('hidden');
  progressContainer.classList.add('hidden');
  finalScore.textContent = points;
  completionScreen.classList.remove('hidden');
}

// Show topic selection screen
function showTopicSelection() {
    completionScreen.classList.add('hidden');
    exerciseContainer.classList.add('hidden');
    progressContainer.classList.add('hidden');
    topicSelectionScreen.classList.remove('hidden');
    renderTopicSelection();
}

// Initialize the app when page loads
window.addEventListener('load', initApp);
</script>
</body>
</html>